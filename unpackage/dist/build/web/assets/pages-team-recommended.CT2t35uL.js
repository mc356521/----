import{g as e,p as a,s,l as o,d as r,m as t,J as m,b as l,a7 as c,e as n,w as i,i as d,f as h,h as f,j as g,t as u,k as y,F as _,G as p,H as T,Q as A,u as S,q as R,x as H,M as k}from"./index-DZtLzZ3A.js";import{H as x}from"./HeaderBar.3x7BGppL.js";import{T as I}from"./TeamCard.DayT38NQ.js";import{T as w}from"./TabBar.D79MOQrs.js";import{t as B}from"./team.VNekZ19c.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./user.BA7q8pkn.js";const C=j({components:{HeaderBar:x,TeamCard:I,TabBar:w},data:()=>({loading:!0,recommendedTeams:[],aiSummary:"",headerPlaceholderHeight:"120rpx"}),onLoad(){this.checkCacheAndLoad()||this.getRecommendedTeams()},onShow(){this.$refs.headerBarRef&&this.updateHeaderHeight()},methods:{updateHeaderHeight(){this.$refs.headerBarRef&&this.$refs.headerBarRef.headerHeight&&(this.headerPlaceholderHeight=this.$refs.headerBarRef.headerHeight+"rpx")},checkCacheAndLoad(){try{const s=e("ai_recommended_teams"),o=e("ai_summary");if(s)try{const e=JSON.parse(s);if(Array.isArray(e)&&e.length>0)return this.recommendedTeams=e,this.aiSummary=o||"根据您的专业、技能和兴趣，我们为您推荐了以下最匹配的团队",this.loading=!1,console.log("组件初始化时使用缓存数据:",e.length,"个推荐队伍"),!0}catch(a){console.error("初始化时解析缓存失败:",a)}else console.log("没有可用的缓存数据")}catch(a){console.error("初始检查缓存出错:",a)}return!1},async getRecommendedTeams(o=!1){if(!o&&this.recommendedTeams.length>0)return console.log("已有推荐数据，不再重复加载"),void(this.loading=!1);this.loading=!0;try{if(console.log("开始获取AI推荐队伍数据，强制刷新:",o),!o){let a=null,s=null;try{a=e("ai_recommended_teams"),s=e("ai_summary"),console.log("缓存状态检查:"),console.log("- 缓存数据存在:",!!a)}catch(r){console.error("读取缓存出错:",r)}if(a){console.log("使用缓存的AI推荐数据");try{const e=JSON.parse(a);if(Array.isArray(e)&&e.length>0)return this.recommendedTeams=e,this.aiSummary=s||"根据您的专业、技能和兴趣，我们为您推荐了以下最匹配的团队",console.log("成功加载缓存数据，推荐队伍数量:",this.recommendedTeams.length),void(this.loading=!1);console.log("缓存数据格式无效，需要重新获取")}catch(r){console.error("解析缓存数据失败:",r)}}}console.log("请求新的AI推荐数据");const s=await B.getRecommendedTeams();if(200===s.code&&s.data){const e=s.data.recommendedTeams||[];this.recommendedTeams=e.map((e=>({...e,matchScore:e.matchScore||Math.floor(30*Math.random())+70,matchReason:e.matchReason||e.recommendReason||"根据您的技能和兴趣推荐",recommendedRole:e.recommendedRole||""}))),this.aiSummary=s.data.aiSummary||"根据您的专业、技能和兴趣，我们为您推荐了以下最匹配的团队",console.log("获取到新的AI推荐队伍数据:",this.recommendedTeams.length,"个队伍");try{a("ai_recommended_teams",JSON.stringify(this.recommendedTeams)),a("ai_summary",this.aiSummary),console.log("AI推荐数据缓存成功")}catch(r){console.error("缓存AI推荐数据失败:",r)}}else if(console.error("获取推荐数据失败:",s.message||"未知错误"),!o)try{const a=e("ai_recommended_teams");if(a){const s=JSON.parse(a);Array.isArray(s)&&s.length>0&&(this.recommendedTeams=s,this.aiSummary=e("ai_summary")||"根据您的专业、技能和兴趣，我们为您推荐了以下最匹配的团队",console.log("使用缓存作为备用数据"))}}catch(r){console.error("解析缓存失败:",r)}}catch(t){if(console.error("获取AI推荐队伍失败:",t),!o)try{const a=e("ai_recommended_teams");if(a){const s=JSON.parse(a);Array.isArray(s)&&s.length>0&&(this.recommendedTeams=s,this.aiSummary=e("ai_summary")||"",console.log("由于请求失败，使用缓存作为备用数据"))}}catch(r){console.error("加载备用缓存失败:",r)}0===this.recommendedTeams.length&&s({title:"获取推荐失败，请稍后再试",icon:"none",duration:2e3})}finally{this.loading=!1,console.log("AI推荐数据加载完成，显示状态更新")}},refreshRecommendations(){o({title:"刷新推荐中..."});try{r("ai_recommended_teams"),r("ai_summary"),console.log("已清除AI推荐缓存，准备获取新数据")}catch(e){console.error("清除缓存失败:",e)}this.getRecommendedTeams(!0).then((()=>{console.log("推荐刷新完成")})).catch((e=>{console.error("推荐刷新出错:",e)})).finally((()=>{t(),s({title:"推荐已更新",icon:"success"})}))},viewTeamDetail(e){m({url:`/pages/team/detail?id=${e}`})},goToProfile(){l({url:"/pages/profile/index"})}}},[["render",function(e,a,s,o,r,t){const m=c("header-bar"),l=S,x=d,I=c("team-card"),w=R,B=H,j=k;return h(),n(x,{class:"container"},{default:i((()=>[f(m,{ref:"headerBarRef",title:"AI智能推荐","show-search":!1,"show-filter":!1,"show-ai-recommend":!1},null,512),f(j,{"scroll-y":"",class:"content-scroll",style:A({paddingTop:r.headerPlaceholderHeight})},{default:i((()=>[r.aiSummary?(h(),n(x,{key:0,class:"ai-summary"},{default:i((()=>[f(x,{class:"summary-header"},{default:i((()=>[f(l,{class:"summary-title"},{default:i((()=>[g("✨ AI分析结果")])),_:1})])),_:1}),f(l,{class:"summary-content"},{default:i((()=>[g(u(r.aiSummary),1)])),_:1})])),_:1})):y("",!0),f(x,{class:"section"},{default:i((()=>[f(x,{class:"section-header"},{default:i((()=>[f(l,{class:"section-title"},{default:i((()=>[g("为您推荐的队伍")])),_:1}),f(x,{class:"refresh-btn",onClick:t.refreshRecommendations},{default:i((()=>[f(l,{class:"iconfont icon-refresh"})])),_:1},8,["onClick"])])),_:1}),r.loading?(h(),n(x,{key:0,class:"loading-container"},{default:i((()=>[f(x,{class:"loading-circle"}),f(l,{class:"loading-text"},{default:i((()=>[g("正在加载推荐...")])),_:1})])),_:1})):r.recommendedTeams.length>0?(h(),n(x,{key:1,class:"team-list"},{default:i((()=>[(h(!0),_(T,null,p(r.recommendedTeams,((e,a)=>(h(),n(I,{key:e.id,team:e,index:a,"show-match":!0,onDetail:t.viewTeamDetail},null,8,["team","index","onDetail"])))),128))])),_:1})):(h(),n(x,{key:2,class:"empty-state"},{default:i((()=>[f(w,{class:"empty-icon",src:"/static/images/empty-data.png",mode:"aspectFit"}),f(l,{class:"empty-text"},{default:i((()=>[g("暂无推荐，请完善个人资料后再试")])),_:1}),f(B,{class:"primary-btn",onClick:t.goToProfile},{default:i((()=>[g("完善资料")])),_:1},8,["onClick"])])),_:1}))])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-d7b37735"]]);export{C as default};
