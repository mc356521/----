import{r as a,o as e,e as l,w as s,s as t,i as c,f as o,h as n,j as i,F as u,G as r,H as d,k as f,l as v,m as _,T as g,u as k,M as y,t as m,n as p}from"./index-DZtLzZ3A.js";import{u as h}from"./user.BA7q8pkn.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=b({__name:"edit-skills",setup(b){const j=a({skillTags:[],realName:"",schoolId:null,major:"",bio:"",awardsHistory:[]}),w=a([]),C=a({}),T=a(""),x=a(!0);async function N(){try{x.value=!0;const a=await h.getUserProfile();200===a.code&&a.data?(j.value=a.data,j.value.skillTags&&Array.isArray(j.value.skillTags)&&(w.value=[...j.value.skillTags]),console.log("获取到用户资料:",j.value),await async function(){try{const a=await h.getSkillTags();if(200===a.code&&a.data){C.value=a.data;const e=Object.keys(a.data);e.length>0&&(T.value=e[0]),console.log("获取技能标签成功:",C.value)}else console.error("获取技能标签失败:",a.message)}catch(a){console.error("获取技能标签失败:",a)}}()):t({title:a.message||"获取资料失败",icon:"none"})}catch(a){console.error("获取用户资料失败:",a),t({title:"获取个人资料失败",icon:"none"})}finally{x.value=!1}}function I(a){w.value.splice(a,1)}async function H(){try{v({title:"保存中..."});const a={realName:j.value.realName,schoolId:j.value.schoolId,major:j.value.major,bio:j.value.bio,skillTags:w.value,awardsHistory:j.value.awardsHistory||[]},e=await h.updateUserProfile(a);200===e.code?(t({title:"保存成功",icon:"success"}),setTimeout((()=>{A()}),1500)):t({title:e.message||"保存失败",icon:"none"})}catch(a){console.error("保存用户资料失败:",a),t({title:"保存失败，请稍后再试",icon:"none"})}finally{_()}}function A(){g()}return e((()=>{N()})),(a,e)=>{const v=k,_=c,g=y;return o(),l(_,{class:"container"},{default:s((()=>[n(_,{class:"header"},{default:s((()=>[n(_,{class:"back-btn",onClick:A},{default:s((()=>[n(v,{class:"iconfont icon-arrow-left"})])),_:1}),n(v,{class:"header-title"},{default:s((()=>[i("编辑技能标签")])),_:1}),n(_,{class:"save-btn",onClick:H},{default:s((()=>[n(v,null,{default:s((()=>[i("保存")])),_:1})])),_:1})])),_:1}),x.value?(o(),l(_,{key:0,class:"loading-container"},{default:s((()=>[n(_,{class:"loading-circle"}),n(v,{class:"loading-text"},{default:s((()=>[i("加载中...")])),_:1})])),_:1})):(o(),l(g,{key:1,"scroll-y":"",class:"content-scroll"},{default:s((()=>[n(_,{class:"selected-section"},{default:s((()=>[n(_,{class:"section-title"},{default:s((()=>[i("已选择的标签")])),_:1}),n(_,{class:"selected-tags"},{default:s((()=>[(o(!0),u(d,null,r(w.value,((a,e)=>(o(),l(_,{key:e,class:"tag selected-tag"},{default:s((()=>[n(v,null,{default:s((()=>[i(m(a),1)])),_:2},1024),n(v,{class:"remove-icon",onClick:a=>I(e)},{default:s((()=>[i("×")])),_:2},1032,["onClick"])])),_:2},1024)))),128)),0===w.value.length?(o(),l(_,{key:0,class:"empty-tips"},{default:s((()=>[n(v,null,{default:s((()=>[i("尚未选择任何标签，请从下方分类中选择")])),_:1})])),_:1})):f("",!0)])),_:1})])),_:1}),n(_,{class:"categories-section"},{default:s((()=>[n(_,{class:"section-title"},{default:s((()=>[i("选择技能标签")])),_:1}),n(_,{class:"categories-tab"},{default:s((()=>[(o(!0),u(d,null,r(Object.keys(C.value),((a,e)=>(o(),l(_,{key:e,class:p(["category-tab",{active:T.value===a}]),onClick:e=>function(a){T.value=a}(a)},{default:s((()=>[n(v,null,{default:s((()=>[i(m(a),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),n(_,{class:"tag-list"},{default:s((()=>[(o(!0),u(d,null,r(C.value[T.value],((a,e)=>{return o(),l(_,{key:e,class:p(["tag",{active:(c=a.tagName,w.value.includes(c))}]),onClick:e=>function(a){const e=w.value.indexOf(a);if(-1===e){if(w.value.length>=10)return void t({title:"最多只能选择10个标签",icon:"none"});w.value.push(a)}else I(e)}(a.tagName)},{default:s((()=>[n(v,null,{default:s((()=>[i(m(a.tagName),1)])),_:2},1024)])),_:2},1032,["class","onClick"]);var c})),128))])),_:1})])),_:1}),n(_,{class:"tips-section"},{default:s((()=>[n(v,{class:"tip-text"},{default:s((()=>[i("提示：精确的技能标签有助于AI更准确地为您推荐合适的团队")])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-5360139c"]]);export{j as default};
