import{a as e,r as l,o as a,g as t,s as o,T as s,E as c,e as n,w as i,i as r,f as u,h as d,j as f,F as m,G as p,H as _,t as h,ab as g,l as b,ac as y,m as v,u as k,M as x,N as V,y as U,ad as q,I as w,q as C,x as E,n as M,a3 as I}from"./index-DZtLzZ3A.js";import{_ as S}from"./uni-easyinput.D7HvsQgj.js";import{r as D}from"./uni-app.es.CpsDs8gT.js";import{c as F}from"./competitions.CeqcXiK9.js";import{u as Q}from"./user.BA7q8pkn.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DmeKPs4e.js";const z=j({__name:"create",setup(j){const z=e({title:"",categoryId:null,level:"",shortDescription:"",description:"",requirements:"",registrationStart:"",registrationEnd:"",teamMin:"",teamMax:"",isHot:!1,websiteUrl:"",name:"",contactQQ:"",contactEmail:"",coverUrl:"",coverFile:null,attachments:[]}),T=l([]),P=["国家级","省级","市级","校级"];function A(e){return{"计算机类":"iconfont icon-computer","设计类":"iconfont icon-palette","创新创业":"iconfont icon-lightbulb","学科竞赛":"iconfont icon-book","科技竞赛":"iconfont icon-chip","文化艺术":"iconfont icon-palette","体育竞赛":"iconfont icon-running"}[e]||"iconfont icon-more"}function B(){T.value=[{label:"创新创业",value:2,icon:"iconfont icon-lightbulb",id:2},{label:"学科竞赛",value:1,icon:"iconfont icon-book",id:1},{label:"科技竞赛",value:3,icon:"iconfont icon-chip",id:3},{label:"文化艺术",value:4,icon:"iconfont icon-palette",id:4},{label:"体育竞赛",value:5,icon:"iconfont icon-running",id:5},{label:"其他",value:6,icon:"iconfont icon-more",id:6}]}function H(){o({title:"只有管理员才能发布竞赛",icon:"none"}),setTimeout((()=>{s()}),1500)}function N(){s()}function J(){if(!z.title)return o({title:"请输入竞赛标题",icon:"none"});K(0)}function O(){g({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{z.coverUrl=e.tempFilePaths[0],z.coverFile=e.tempFiles[0]}})}function G(){const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.zip",e.onchange=e=>{const l=Array.from(e.target.files).map((e=>({name:e.name,size:e.size,file:e})));z.attachments=[...z.attachments,...l]},e.click()}function R(){(function(){if(!z.title)return W("请输入竞赛标题"),!1;if(!z.categoryId)return W("请选择竞赛分类"),!1;if(!z.level)return W("请选择竞赛级别"),!1;if(!z.shortDescription)return W("请填写竞赛简介"),!1;if(!z.description)return W("请填写竞赛介绍"),!1;if(!z.requirements)return W("请填写参赛要求"),!1;if(!z.registrationStart||!z.registrationEnd)return W("请选择竞赛时间"),!1;if(!z.teamMin||!z.teamMax)return W("请填写团队人数"),!1;if(!z.name||!z.contactEmail)return W("请填写联系方式"),!1;if(!z.coverUrl)return W("请上传竞赛封面"),!1;return!0})()&&K(1)}function W(e){o({title:e,icon:"none"})}async function K(e){const l={title:z.title,categoryId:z.categoryId,level:z.level,shortDescription:z.shortDescription,description:z.description,requirements:z.requirements,registrationStart:z.registrationStart+"T00:00:00",registrationDeadline:z.registrationEnd+"T23:59:59",teamSize:parseInt(z.teamMin)||1,teamMax:parseInt(z.teamMax)||5,status:e.toString(),organizer:"主办方名称",websiteUrl:z.websiteUrl,contactInfo:{email:z.contactEmail,qq:z.contactQQ,name:z.name}};b({title:0===e?"保存中...":"发布中..."});try{const a=new FormData;a.append("competitionData",JSON.stringify(l)),z.coverFile&&a.append("coverImage",z.coverFile),z.attachments.forEach(((e,l)=>{e.file&&a.append("attachmentFiles",e.file)}));const c=t("token"),n=await new Promise(((e,a)=>{y({url:"http://localhost:8080/competitions/with-files",files:z.attachments.map((e=>({name:"attachmentFiles",file:e.file}))),filePath:z.coverUrl,name:"coverImage",formData:{competitionData:JSON.stringify(l)},header:{Authorization:"Bearer "+c},success:l=>{let a;try{a=JSON.parse(l.data)}catch(t){a={code:-1,message:"返回数据解析失败"}}e(a)},fail:e=>{a(e)}})}));200===n.code?(o({title:0===e?"保存成功":"发布成功",icon:"success"}),setTimeout((()=>{s()}),1500)):o({title:n.message||"操作失败",icon:"none"})}catch(a){console.error("操作失败:",a),o({title:"操作失败，请重试",icon:"none"})}finally{v()}}return a((async()=>{await async function(){try{const e=t("token");if(!e)return void H();const l=await Q.getUserRole(e);200===l.code&&"admin"===l.data||H()}catch(e){console.error("获取角色失败:",e),H()}}(),await async function(){try{const e=await F.getCompetitionCategories();200===e.code&&e.data&&Array.isArray(e.data)?T.value=e.data.map((e=>({label:e.name,value:e.id,icon:A(e.name),id:e.id}))):(console.error("获取分类失败:",e),B())}catch(e){console.error("获取分类出错:",e),B()}}()})),(e,l)=>{const a=k,t=r,o=D(c("uni-easyinput"),S),s=x,g=V,b=U,y=q,v=w,F=C,Q=E;return u(),n(t,{class:"container"},{default:i((()=>[d(t,{class:"sticky-header"},{default:i((()=>[d(t,{class:"nav-bar"},{default:i((()=>[d(t,{class:"back-btn",onClick:N},{default:i((()=>[d(a,{class:"iconfont icon-arrow-left"})])),_:1}),d(a,{class:"page-title"},{default:i((()=>[f("发布竞赛")])),_:1}),d(t,{class:"draft-btn",onClick:J},{default:i((()=>[f("草稿箱")])),_:1})])),_:1})])),_:1}),d(s,{"scroll-y":"",class:"form-content"},{default:i((()=>[d(t,{class:"form-section"},{default:i((()=>[d(a,{class:"section-title"},{default:i((()=>[f("基本信息")])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛标题")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(o,{type:"text",modelValue:z.title,"onUpdate:modelValue":l[0]||(l[0]=e=>z.title=e),placeholder:"请输入竞赛名称（5-50字",clearable:!1},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛分类")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(t,{class:"category-grid"},{default:i((()=>[(u(!0),m(_,null,p(T.value,((e,l)=>(u(),n(t,{key:l,class:M(["category-item",{"category-active":z.categoryId===e.id}]),onClick:l=>z.categoryId=e.id},{default:i((()=>[d(a,{class:M(["category-icon",e.icon])},null,8,["class"]),d(a,null,{default:i((()=>[f(h(e.label),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),d(t,null,{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛级别")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(s,{class:"level-scroll","scroll-x":""},{default:i((()=>[d(t,{class:"level-list"},{default:i((()=>[(u(),m(_,null,p(P,((e,l)=>d(t,{key:l,class:M(["level-item",{"level-active":z.level===e}]),onClick:l=>z.level=e},{default:i((()=>[d(a,null,{default:i((()=>[f(h(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1})])),_:1})])),_:1}),d(t,{class:"form-section"},{default:i((()=>[d(a,{class:"section-title"},{default:i((()=>[f("竞赛详情")])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛简介")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(g,{modelValue:z.shortDescription,"onUpdate:modelValue":l[1]||(l[1]=e=>z.shortDescription=e),placeholder:"请填写竞赛简介（10-30个字）",class:"form-textarea",maxlength:"140"},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛介绍")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(g,{modelValue:z.description,"onUpdate:modelValue":l[2]||(l[2]=e=>z.description=e),placeholder:"请详细描述竞赛背景、目的和意义（50-1000字）",class:"form-textarea",maxlength:"2000"},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("参赛要求")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(g,{modelValue:z.requirements,"onUpdate:modelValue":l[3]||(l[3]=e=>z.requirements=e),placeholder:"请说明参赛资格、人数限制等要求（20-500字）",class:"form-textarea form-textarea-medium",maxlength:"1000"},null,8,["modelValue"])])),_:1})])),_:1}),d(t,{class:"form-section"},{default:i((()=>[d(a,{class:"section-title"},{default:i((()=>[f("时间与团队")])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛时间")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(t,{class:"time-grid"},{default:i((()=>[d(t,{class:"time-column"},{default:i((()=>[d(a,{class:"time-label"},{default:i((()=>[f("报名开始时间")])),_:1}),d(b,{mode:"date",value:z.registrationStart,onChange:l[4]||(l[4]=e=>z.registrationStart=e.detail.value),class:"date-picker"},{default:i((()=>[d(t,{class:"picker-view"},{default:i((()=>[z.registrationStart?(u(),n(a,{key:0},{default:i((()=>[f(h(z.registrationStart),1)])),_:1})):(u(),n(a,{key:1,class:"placeholder-text"},{default:i((()=>[f("选择日期")])),_:1}))])),_:1})])),_:1},8,["value"])])),_:1}),d(t,{class:"time-column"},{default:i((()=>[d(a,{class:"time-label"},{default:i((()=>[f("报名截止时间")])),_:1}),d(b,{mode:"date",value:z.registrationEnd,onChange:l[5]||(l[5]=e=>z.registrationEnd=e.detail.value),class:"date-picker"},{default:i((()=>[d(t,{class:"picker-view"},{default:i((()=>[z.registrationEnd?(u(),n(a,{key:0},{default:i((()=>[f(h(z.registrationEnd),1)])),_:1})):(u(),n(a,{key:1,class:"placeholder-text"},{default:i((()=>[f("选择日期")])),_:1}))])),_:1})])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("团队人数")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(t,{class:"time-grid"},{default:i((()=>[d(t,{class:"time-column"},{default:i((()=>[d(a,{class:"time-label"},{default:i((()=>[f("最少人数")])),_:1}),d(o,{type:"number",modelValue:z.teamMin,"onUpdate:modelValue":l[6]||(l[6]=e=>z.teamMin=e),placeholder:"输入人数",clearable:!1},null,8,["modelValue"])])),_:1}),d(t,{class:"time-column"},{default:i((()=>[d(a,{class:"time-label"},{default:i((()=>[f("最多人数")])),_:1}),d(o,{type:"number",modelValue:z.teamMax,"onUpdate:modelValue":l[7]||(l[7]=e=>z.teamMax=e),placeholder:"输入人数",clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),d(t,{class:"hot-toggle"},{default:i((()=>[d(t,{class:"hot-info"},{default:i((()=>[d(a,{class:"hot-title"},{default:i((()=>[f("设为热门竞赛")])),_:1}),d(a,{class:"hot-desc"},{default:i((()=>[f("热门竞赛将在首页和竞赛列表优先展示")])),_:1})])),_:1}),d(y,{checked:z.isHot,onChange:l[8]||(l[8]=e=>z.isHot=e.detail.value),color:"#00aaff"},null,8,["checked"])])),_:1})])),_:1}),d(t,{class:"form-section"},{default:i((()=>[d(a,{class:"section-title"},{default:i((()=>[f("联系方式与附件")])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("官方网站（可选）")])),_:1})])),_:1}),d(o,{type:"text",modelValue:z.websiteUrl,"onUpdate:modelValue":l[9]||(l[9]=e=>z.websiteUrl=e),placeholder:"输入网站",clearable:!1},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("联系方式")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(t,{class:"contact-grid"},{default:i((()=>[d(t,{class:"contact-row"},{default:i((()=>[d(t,{class:"contact-input"},{default:i((()=>[d(a,{class:"contact-icon iconfont icon-user"}),d(v,{type:"text",modelValue:z.name,"onUpdate:modelValue":l[10]||(l[10]=e=>z.name=e),placeholder:"联系人"},null,8,["modelValue"])])),_:1}),d(t,{class:"contact-input"},{default:i((()=>[d(a,{class:"contact-icon iconfont icon-qq"}),d(v,{type:"text",modelValue:z.contactQQ,"onUpdate:modelValue":l[11]||(l[11]=e=>z.contactQQ=e),placeholder:"QQ群"},null,8,["modelValue"])])),_:1})])),_:1}),d(t,{class:"contact-input contact-email"},{default:i((()=>[d(a,{class:"contact-icon iconfont icon-email"}),d(v,{type:"text",modelValue:z.contactEmail,"onUpdate:modelValue":l[12]||(l[12]=e=>z.contactEmail=e),placeholder:"联系邮箱"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛封面")])),_:1}),d(a,{class:"required"},{default:i((()=>[f("*")])),_:1})])),_:1}),d(t,{class:"upload-box",onClick:O},{default:i((()=>[z.coverUrl?(u(),n(F,{key:1,src:z.coverUrl,mode:"aspectFill",class:"cover-image"},null,8,["src"])):(u(),n(t,{key:0,class:"upload-placeholder"},{default:i((()=>[d(a,{class:"upload-icon iconfont icon-image"}),d(a,{class:"upload-text"},{default:i((()=>[f("点击上传或拖拽图片至此处")])),_:1}),d(a,{class:"upload-tip"},{default:i((()=>[f("建议尺寸：800x400，文件大小不超过2MB")])),_:1})])),_:1}))])),_:1})])),_:1}),d(t,{class:"form-item"},{default:i((()=>[d(t,{class:"form-label"},{default:i((()=>[d(a,null,{default:i((()=>[f("竞赛附件（可选）")])),_:1})])),_:1}),d(t,{class:"upload-box",onClick:G},{default:i((()=>[0===z.attachments.length?(u(),n(t,{key:0,class:"upload-placeholder"},{default:i((()=>[d(a,{class:"upload-icon iconfont icon-file"}),d(a,{class:"upload-text"},{default:i((()=>[f("点击上传或拖拽文件至此处")])),_:1}),d(a,{class:"upload-tip"},{default:i((()=>[f("支持PDF、Word、PPT等格式，单个文件不超过10MB")])),_:1})])),_:1})):(u(),n(t,{key:1,class:"file-list"},{default:i((()=>[(u(!0),m(_,null,p(z.attachments,((e,l)=>(u(),n(t,{key:l,class:"file-item"},{default:i((()=>[d(a,{class:"file-icon iconfont icon-file"}),d(a,{class:"file-name"},{default:i((()=>[f(h(e.name),1)])),_:2},1024),d(a,{class:"delete-icon iconfont icon-close",onClick:I((e=>function(e){z.attachments.splice(e,1)}(l)),["stop"])},null,8,["onClick"])])),_:2},1024)))),128))])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1}),d(t,{class:"action-bar"},{default:i((()=>[d(t,{class:"action-grid"},{default:i((()=>[d(Q,{class:"draft-button",onClick:J},{default:i((()=>[f("保存草稿")])),_:1}),d(Q,{class:"publish-button",onClick:R},{default:i((()=>[d(a,{class:"iconfont icon-send"}),d(a,null,{default:i((()=>[f("发布竞赛")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-5fcefcdf"]]);export{z as default};
