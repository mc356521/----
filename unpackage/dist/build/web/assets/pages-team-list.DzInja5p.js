import{r as e,c as a,a as t,o as s,g as l,V as o,J as n,e as i,w as u,s as r,d as c,i as d,f as g,h as p,Q as f,F as m,G as h,H as v,j as x,k as y,b as _,a1 as k,u as N,M as T}from"./index-DZtLzZ3A.js";import{T as j}from"./TeamCard.DayT38NQ.js";import{T as C}from"./TabBar.D79MOQrs.js";import{H as b}from"./HeaderBar.3x7BGppL.js";import{t as w}from"./team.VNekZ19c.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./user.BA7q8pkn.js";const I=S({__name:"list",setup(S){const I=e(["全部队伍","学科竞赛","创新创业","体育竞赛","文艺比赛"]),H=e(0),$=e(null),z=a((()=>$.value&&$.value.headerHeight?$.value.headerHeight+"rpx":I.value&&I.value.length>0?"200rpx":"120rpx")),B=t({pageNum:1,pageSize:10,total:0,pages:0,list:[],hasPrevious:!1,hasNext:!1}),P=e(!1),L=e(!1),F=e(!1),V=e(!1),q=t({pageNum:1,pageSize:10,keyword:"",orderByViewCount:!1});async function A(e=!1){e?(q.pageNum=1,L.value=!0):P.value=!0;try{const a={};Object.keys(q).forEach((e=>{null!==q[e]&&void 0!==q[e]&&""!==q[e]&&(a[e]=q[e])})),console.log("请求参数:",a);const t=await w.getTeamList(a);console.log("响应结果:",t),200===t.code&&t.data?(B.list=e?t.data.list||[]:[...B.list,...t.data.list||[]],B.pageNum=t.data.pageNum,B.pageSize=t.data.pageSize,B.total=t.data.total,B.pages=t.data.pages,B.hasPrevious=t.data.hasPrevious,B.hasNext=t.data.hasNext,V.value=!t.data.hasNext):r({title:(null==t?void 0:t.message)||"获取团队列表失败",icon:"none"})}catch(a){console.error("获取团队列表出错",a),401===a.statusCode||403===a.statusCode?o({title:"登录已过期",content:"请重新登录后查看",confirmText:"去登录",success:function(e){e.confirm&&(c("token"),n({url:"/pages/login/login"}))}}):r({title:"网络异常，请稍后重试",icon:"none"})}finally{P.value=!1,L.value=!1,F.value=!1}}function D(){F.value||V.value||(B.hasNext?(F.value=!0,q.pageNum+=1,A()):V.value=!0)}function E(e){H.value!==e&&(H.value=e,0===e?delete q.categoryId:q.categoryId=e,A(!0))}function G(e){n({url:`/pages/team/detail?id=${e}`})}function J(e){l("token")?w.checkTeamStatus(e).then((a=>{200===a.code&&(!0===a.data?r({title:"您已申请或已加入该团队",icon:"none"}):n({url:`/pages/team/detail?id=${e}`}))})).catch((a=>{console.error("检查团队状态失败",a),n({url:`/pages/team/detail?id=${e}`})})):o({title:"提示",content:"请先登录后再申请加入团队",confirmText:"去登录",success:function(e){e.confirm&&n({url:"/pages/login/login"})}})}function M(e){"home"===e?_({url:"/pages/index/index"}):"competition"===e?_({url:"/pages/competition/index"}):"profile"===e&&_({url:"/pages/profile/index"})}function O(){k({itemList:["创建新团队","招募队友","发布项目展示"],success:function(e){0===e.tapIndex?n({url:"/pages/team/create"}):r({title:`选择了: ${e.tapIndex}`,icon:"none"})}})}function Q(){n({url:"/pages/search/index"})}function R(){k({itemList:["最新发布","热门团队","即将截止"],success:function(e){r({title:`选择了筛选: ${e.tapIndex}`,icon:"none"})}})}return s((()=>{console.log("组队列表页面加载");l("token")?A():o({title:"提示",content:"请先登录后查看团队列表",confirmText:"去登录",success:function(e){e.confirm&&n({url:"/pages/login/login"})}})})),(e,a)=>{const t=d,s=N,l=T;return g(),i(t,{class:"container"},{default:u((()=>[p(b,{ref_key:"headerBarRef",ref:$,title:"组队广场",categories:I.value,"default-category":H.value,"show-filter":"true",onSearch:Q,onFilter:R,onCategoryChange:E},null,8,["categories","default-category"]),p(t,{class:"header-placeholder",style:f({height:z.value})},null,8,["style"]),p(l,{"scroll-y":"true",class:"team-list",onScrolltolower:D},{default:u((()=>[B.list&&B.list.length>0?(g(!0),m(v,{key:0},h(B.list,((e,a)=>(g(),i(j,{key:e.id,team:e,index:a,onDetail:G,onApply:J},null,8,["team","index"])))),128)):P.value?(g(),i(t,{key:1,class:"loading-state"},{default:u((()=>[p(t,{class:"loading-spinner"}),p(s,{class:"loading-text"},{default:u((()=>[x("加载中...")])),_:1})])),_:1})):(g(),i(t,{key:2,class:"empty-state"},{default:u((()=>[p(s,{class:"empty-text"},{default:u((()=>[x("暂无团队数据")])),_:1})])),_:1})),B.list&&B.list.length>0?(g(),i(t,{key:3,class:"load-more"},{default:u((()=>[F.value?(g(),i(s,{key:0},{default:u((()=>[x("正在加载更多...")])),_:1})):B.hasNext?(g(),i(s,{key:1,onClick:D},{default:u((()=>[x("点击加载更多")])),_:1})):(g(),i(s,{key:2},{default:u((()=>[x("— 没有更多数据了 —")])),_:1}))])),_:1})):y("",!0)])),_:1}),p(C,{"active-tab":"team",onTabChange:M,onPublish:O})])),_:1})}}},[["__scopeId","data-v-fef8284b"]]);export{I as default};
