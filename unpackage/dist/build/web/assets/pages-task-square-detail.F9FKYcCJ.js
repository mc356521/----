import{r as e,c as t,o as a,R as s,s as l,T as r,l as c,O as n,U as i,m as o,e as u,w as d,i as f,f as p,h as v,j as m,t as _,n as g,k as y,F as h,G as w,H as k,V as b,J as x,u as T,q as $,M as j,x as A,W as I}from"./index-DZtLzZ3A.js";import{a as M}from"./index.BRmG1gro.js";import{H as N}from"./HeaderBar.3x7BGppL.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./user.BA7q8pkn.js";import"./team.VNekZ19c.js";import"./competitions.CeqcXiK9.js";import"./taskApplications.MAaxBfY8.js";const q=P({__name:"detail",setup(P,{expose:q}){const D=e(null),S=e(!1);e(!1),e(0);const C=e(!1),F=e({id:0,title:"",description:"",requirements:"",contactInfo:"",categoryId:0,categoryName:"",creatorId:0,creatorName:"",creatorAvatarUrl:"",creatorMajor:"",rewardTypeId:0,rewardTypeName:"",rewardAmount:0,createdAt:"",deadline:"",status:"recruiting",maxParticipants:0,currentParticipants:0,viewCount:0,location:""}),H=t((()=>{if(!F.value.contactInfo)return null;try{let e;return e="string"==typeof F.value.contactInfo?JSON.parse(F.value.contactInfo):F.value.contactInfo,e}catch(e){return console.error("解析联系方式失败:",e),null}})),O=t((()=>H.value?Object.entries(H.value).filter((([e,t])=>t&&""!==t.toString().trim())).map((([e,t])=>({key:e,value:t}))):[])),R=t((()=>!!C.value||("recruiting"!==F.value.status||F.value.currentParticipants>=F.value.maxParticipants)));async function U(e){if(e)try{c({title:"加载中..."});const t=await n({url:`/tasks/${e}`,method:"GET"});200===t.code&&t.data?(F.value=t.data,async function(e){try{const t=await M.taskApplications.checkTaskApplication(e);200===t.code&&t.data&&(C.value=t.data.participated||!1)}catch(t){console.error("检查申请状态失败:",t),C.value=!1}}(e),F.value.title&&i({title:"任务详情"})):(console.error("获取任务详情失败:",t),l({title:"获取任务详情失败",icon:"none"}))}catch(t){console.error("获取任务详情异常:",t)}finally{o()}else l({title:"任务ID无效",icon:"none"})}function Y(e){if(!e)return"";try{const t=new Date(e),a=new Date,s=["日","一","二","三","四","五","六"],l=t.getHours().toString().padStart(2,"0"),r=`${l}:${t.getMinutes().toString().padStart(2,"0")}`;if(t.getFullYear()===a.getFullYear()){const e=t.getMonth()+1,a=t.getDate();return`${e}月${a}日 周${s[t.getDay()]} ${r}`}return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()} ${r}`}catch(t){return e}}function B(e){if(!e)return"";try{const t=new Date(e),a=(new Date).getTime()-t.getTime(),s=6e4,l=60*s,r=24*l,c=7*r,n=30*r;return a<s?"刚刚":a<l?Math.floor(a/s)+"分钟前":a<r?Math.floor(a/l)+"小时前":a<c?Math.floor(a/r)+"天前":a<n?Math.floor(a/c)+"周前":Math.floor(a/n)+"个月前"}catch(t){return e}}function G(e){switch(e){case"recruiting":return"status-recruiting";case"ongoing":return"status-ongoing";case"completed":return"status-completed";case"ended":return"status-ended";case"canceled":return"status-canceled";default:return""}}function J(e){switch(e){case"现金":return"报酬";case"学分":return"学分奖励";case"志愿服务":return"志愿时长";case"证书":return"证书奖励";default:return"奖励"}}function Q(e){switch(e){case"现金":return"reward-orange";case"学分":return"reward-blue";case"志愿服务":return"reward-green";case"证书":return"reward-yellow";default:return""}}function E(e){switch(e){case"phone":return"电话";case"wechat":return"微信";case"qq":return"QQ";case"email":return"邮箱";default:return e}}function L(){r()}async function V(){D.value}async function W(){R.value||b({title:"申请任务",content:"确定要申请该任务吗？",editable:!0,placeholderText:"可选择填写申请理由（如有特长、经验等）",success:async e=>{if(e.confirm)try{c({title:"提交申请中..."});const t=await M.taskApplications.createTaskApplication({taskId:D.value,message:e.content||"我对这个任务很感兴趣，希望能参与。",status:"pending"});o(),200===t.code?(l({title:"申请成功，等待审核",icon:"success"}),C.value=!0,setTimeout((()=>{x({url:"/pages/application/application"})}),1500)):l({title:t.message||"申请失败",icon:"none"})}catch(t){o(),console.error("申请任务失败:",t),l({title:"申请失败，请稍后重试",icon:"none"})}}})}return a((()=>{!function(){try{let e=null;const t=s();if(t&&t.length>0){const a=t[t.length-1];if(a.options&&a.options.id)e=a.options.id;else if(a.$page&&a.$page.fullPath){const t=a.$page.fullPath,s=t.indexOf("?");if(s>-1){const a=t.substring(s+1).split("&");for(let t of a){const[a,s]=t.split("=");if("id"===a&&s){e=s;break}}}}else a.__displayReporter&&a.__displayReporter.query&&(e=a.__displayReporter.query.id)}e?(D.value=e,U(e)):(l({title:"无法获取任务信息",icon:"none"}),setTimeout((()=>{r()}),1500))}catch(e){console.error("获取任务ID出错:",e),l({title:"加载任务详情失败",icon:"none"})}}()})),q({onLoad(e){e&&e.id&&(D.value=e.id,U(e.id))}}),(e,t)=>{const a=T,s=f,r=$,c=j,n=A;return p(),u(s,{class:"container"},{default:d((()=>[v(N,{title:"任务详情","show-search":!1,"show-filter":!1,onBack:L}),v(c,{"scroll-y":"",class:"content-scroll"},{default:d((()=>[v(s,{class:"top-info-card"},{default:d((()=>[v(s,{class:"title-status-row"},{default:d((()=>[v(a,{class:"task-title"},{default:d((()=>[m(_(F.value.title),1)])),_:1}),v(a,{class:g(["task-status-tag",G(F.value.status)])},{default:d((()=>[m(_(F.value.statusText),1)])),_:1},8,["class"])])),_:1}),v(s,{class:"publisher-info-row"},{default:d((()=>[v(r,{class:"publisher-avatar",src:F.value.creatorAvatarUrl||"https://via.placeholder.com/100",mode:"aspectFill"},null,8,["src"]),v(s,{class:"publisher-text"},{default:d((()=>[v(a,{class:"publisher-name"},{default:d((()=>[m(_(F.value.creatorName),1)])),_:1}),v(a,{class:"publisher-extra"},{default:d((()=>[m(_(F.value.creatorMajor)+" · "+_(B(F.value.createdAt))+"发布",1)])),_:1})])),_:1})])),_:1})])),_:1}),v(s,{class:"detail-card"},{default:d((()=>[v(s,{class:"card-title"},{default:d((()=>[m("任务详情")])),_:1}),v(s,{class:"card-content description-content"},{default:d((()=>[v(a,{class:"description-text"},{default:d((()=>[m(_(F.value.description),1)])),_:1})])),_:1})])),_:1}),F.value.requirements?(p(),u(s,{key:0,class:"detail-card"},{default:d((()=>[v(s,{class:"card-title"},{default:d((()=>[m("任务要求")])),_:1}),v(s,{class:"card-content description-content"},{default:d((()=>[v(a,{class:"description-text"},{default:d((()=>[m(_(F.value.requirements),1)])),_:1})])),_:1})])),_:1})):y("",!0),v(s,{class:"info-grid"},{default:d((()=>[v(s,{class:"info-grid-item"},{default:d((()=>[v(a,{class:"grid-item-label"},{default:d((()=>[m("时间")])),_:1}),v(s,{class:"grid-item-content"},{default:d((()=>[v(a,{class:"iconfont icon-clock"}),v(a,{class:"grid-item-value"},{default:d((()=>[m(_(Y(F.value.deadline)),1)])),_:1})])),_:1})])),_:1}),F.value.location?(p(),u(s,{key:0,class:"info-grid-item"},{default:d((()=>[v(a,{class:"grid-item-label"},{default:d((()=>[m("地点")])),_:1}),v(s,{class:"grid-item-content"},{default:d((()=>[v(a,{class:"iconfont icon-location"}),v(a,{class:"grid-item-value"},{default:d((()=>[m(_(F.value.location),1)])),_:1})])),_:1})])),_:1})):y("",!0),v(s,{class:"info-grid-item"},{default:d((()=>[v(a,{class:"grid-item-label"},{default:d((()=>[m(_(J(F.value.rewardTypeName)),1)])),_:1}),v(s,{class:"grid-item-content"},{default:d((()=>[v(a,{class:"iconfont icon-reward"}),v(a,{class:g(["grid-item-value reward-text",Q(F.value.rewardTypeName)])},{default:d((()=>["现金"===F.value.rewardTypeName?(p(),u(a,{key:0},{default:d((()=>[m("¥"+_(F.value.rewardAmount),1)])),_:1})):"学分"===F.value.rewardTypeName?(p(),u(a,{key:1},{default:d((()=>[m(_(F.value.rewardAmount)+" 学分",1)])),_:1})):(p(),u(a,{key:2},{default:d((()=>[m(_(F.value.rewardTypeName),1)])),_:1}))])),_:1},8,["class"])])),_:1})])),_:1}),v(s,{class:"info-grid-item"},{default:d((()=>[v(a,{class:"grid-item-label"},{default:d((()=>[m("参与人数")])),_:1}),v(s,{class:"grid-item-content"},{default:d((()=>[v(a,{class:"iconfont icon-user"}),v(a,{class:"grid-item-value"},{default:d((()=>[m(_(F.value.currentParticipants)+"/"+_(F.value.maxParticipants)+" 人",1)])),_:1})])),_:1})])),_:1})])),_:1}),O.value.length>0?(p(),u(s,{key:1,class:"detail-card"},{default:d((()=>[v(s,{class:"card-title"},{default:d((()=>[m("联系方式")])),_:1}),v(s,{class:"contact-list"},{default:d((()=>[(p(!0),h(k,null,w(O.value,(e=>(p(),u(s,{class:"contact-item",key:e.key,onClick:t=>{return a=e.value,void I({data:a,success:()=>{l({title:"复制成功",icon:"success"})}});var a}},{default:d((()=>[v(a,{class:"contact-type"},{default:d((()=>[m(_(E(e.key)),1)])),_:2},1024),v(s,{class:"contact-value-container"},{default:d((()=>[v(a,{class:"contact-value"},{default:d((()=>[m(_(e.value),1)])),_:2},1024),v(a,{class:"copy-hint"},{default:d((()=>[m("点击复制")])),_:1})])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):y("",!0)])),_:1}),v(s,{class:"bottom-actions"},{default:d((()=>[v(s,{class:"action-btn favorite",onClick:V},{default:d((()=>[v(a,{class:g(["iconfont",S.value?"icon-star-filled":"icon-star"])},null,8,["class"]),v(a,null,{default:d((()=>[m(_(S.value?"已收藏":"收藏"),1)])),_:1})])),_:1}),v(n,{class:g(["apply-btn",{"disabled-btn":R.value}]),disabled:R.value,onClick:W},{default:d((()=>[m(_(C.value?"已申请":"recruiting"===F.value.status?F.value.currentParticipants>=F.value.maxParticipants?"名额已满":"立即申请":"ongoing"===F.value.status?"进行中":"completed"===F.value.status?"已完成":"ended"===F.value.status?"已结束":"canceled"===F.value.status?"已取消":"立即申请"),1)])),_:1},8,["class","disabled"])])),_:1})])),_:1})}}},[["__scopeId","data-v-6468f48b"]]);export{q as default};
