import{r as a,o as e,E as l,e as s,w as t,s as o,i as u,f as n,h as c,j as i,F as r,G as d,H as f,k as v,t as m,l as _,m as p,T as w,u as g,M as y,I as k,y as h,x as b,V as x}from"./index-DZtLzZ3A.js";import{_ as C}from"./uni-popup.DyDFSo5l.js";import{r as T}from"./uni-app.es.CpsDs8gT.js";import{u as N}from"./user.BA7q8pkn.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=j({__name:"edit-awards",setup(j){const z=a({awardsHistory:[],realName:"",schoolId:null,major:"",bio:"",skillTags:[]}),V=a([]),H=["国家级","省级","市级","校级","院级","其他"],I=a(0),q=a({awardName:"",level:"",organization:"",awardTime:""}),U=a(!1),P=a(-1),A=a(!0),E=a(null);function F(){E.value&&E.value.open()}function G(){E.value&&E.value.close()}function M(a){const e=a.detail.value;I.value=e,q.value.level=H[e]}function O(a){q.value.awardTime=a.detail.value}function B(){q.value.awardName&&""!==q.value.awardName.trim()?q.value.level?q.value.organization&&""!==q.value.organization.trim()?q.value.awardTime?(U.value&&P.value>=0?V.value[P.value]={...q.value}:V.value.push({...q.value}),G(),o({title:U.value?"修改成功":"添加成功",icon:"success"})):o({title:"请选择获奖时间",icon:"none"}):o({title:"请输入颁发机构",icon:"none"}):o({title:"请选择获奖级别",icon:"none"}):o({title:"请输入奖项名称",icon:"none"})}async function D(){try{_({title:"保存中..."});const a={realName:z.value.realName,schoolId:z.value.schoolId,major:z.value.major,bio:z.value.bio,skillTags:z.value.skillTags||[],awardsHistory:V.value},e=await N.updateUserProfile(a);200===e.code?(o({title:"保存成功",icon:"success"}),setTimeout((()=>{J()}),1500)):o({title:e.message||"保存失败",icon:"none"})}catch(a){console.error("保存用户资料失败:",a),o({title:"保存失败，请稍后再试",icon:"none"})}finally{p()}}function J(){w()}return e((()=>{!async function(){try{A.value=!0;const a=await N.getUserProfile();200===a.code&&a.data?(z.value=a.data,z.value.awardsHistory&&Array.isArray(z.value.awardsHistory)&&(V.value=[...z.value.awardsHistory]),console.log("获取到用户资料:",z.value)):o({title:a.message||"获取资料失败",icon:"none"})}catch(a){console.error("获取用户资料失败:",a),o({title:"获取个人资料失败",icon:"none"})}finally{A.value=!1}}()})),(a,e)=>{const _=g,p=u,w=y,N=k,j=h,z=b,K=T(l("uni-popup"),C);return n(),s(p,{class:"container"},{default:t((()=>[c(p,{class:"header"},{default:t((()=>[c(p,{class:"back-btn",onClick:J},{default:t((()=>[c(_,{class:"iconfont icon-arrow-left"})])),_:1}),c(_,{class:"header-title"},{default:t((()=>[i("编辑获奖经历")])),_:1}),c(p,{class:"save-btn",onClick:D},{default:t((()=>[c(_,null,{default:t((()=>[i("保存")])),_:1})])),_:1})])),_:1}),A.value?(n(),s(p,{key:0,class:"loading-container"},{default:t((()=>[c(p,{class:"loading-circle"}),c(_,{class:"loading-text"},{default:t((()=>[i("加载中...")])),_:1})])),_:1})):(n(),s(w,{key:1,"scroll-y":"",class:"content-scroll"},{default:t((()=>[c(p,{class:"awards-list"},{default:t((()=>[(n(!0),r(f,null,d(V.value,((a,e)=>(n(),s(p,{key:e,class:"award-item"},{default:t((()=>[c(p,{class:"award-content"},{default:t((()=>[c(p,{class:"award-header"},{default:t((()=>[c(_,{class:"award-name"},{default:t((()=>[i(m(a.awardName),1)])),_:2},1024),c(_,{class:"award-level"},{default:t((()=>[i(m(a.level),1)])),_:2},1024)])),_:2},1024),c(p,{class:"award-detail"},{default:t((()=>[c(_,{class:"award-org"},{default:t((()=>[i(m(a.organization),1)])),_:2},1024),c(_,{class:"award-time"},{default:t((()=>[i(m(a.awardTime),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),c(p,{class:"award-actions"},{default:t((()=>[c(p,{class:"action-btn edit-btn",onClick:a=>function(a){if(a>=0&&a<V.value.length){U.value=!0,P.value=a,q.value={...V.value[a]};const e=q.value.level,l=H.indexOf(e);I.value=l>=0?l:0,F()}}(e)},{default:t((()=>[c(_,{class:"iconfont icon-edit"})])),_:2},1032,["onClick"]),c(p,{class:"action-btn delete-btn",onClick:a=>function(a){x({title:"删除确认",content:"确定要删除这条获奖记录吗？",success:function(e){e.confirm&&(V.value.splice(a,1),o({title:"已删除",icon:"success"}))}})}(e)},{default:t((()=>[c(_,{class:"iconfont icon-trash"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),0===V.value.length?(n(),s(p,{key:0,class:"empty-state"},{default:t((()=>[c(_,null,{default:t((()=>[i("暂无获奖记录，点击下方添加按钮添加")])),_:1})])),_:1})):v("",!0)])),_:1}),c(p,{class:"add-btn",onClick:e[0]||(e[0]=a=>(null===null&&(U.value=!1,P.value=-1,q.value={awardName:"",level:H[0],organization:"",awardTime:""},I.value=0),void F()))},{default:t((()=>[c(_,{class:"iconfont icon-plus"}),c(_,{class:"add-text"},{default:t((()=>[i("添加获奖经历")])),_:1})])),_:1})])),_:1})),c(K,{ref_key:"awardPopup",ref:E,type:"center"},{default:t((()=>[c(p,{class:"award-form"},{default:t((()=>[c(p,{class:"form-header"},{default:t((()=>[c(_,{class:"form-title"},{default:t((()=>[i(m(U.value?"编辑获奖经历":"添加获奖经历"),1)])),_:1}),c(_,{class:"close-icon",onClick:G},{default:t((()=>[i("×")])),_:1})])),_:1}),c(p,{class:"form-body"},{default:t((()=>[c(p,{class:"form-item"},{default:t((()=>[c(_,{class:"form-label"},{default:t((()=>[i("奖项名称"),c(_,{class:"required"},{default:t((()=>[i("*")])),_:1})])),_:1}),c(N,{class:"form-input",type:"text",modelValue:q.value.awardName,"onUpdate:modelValue":e[1]||(e[1]=a=>q.value.awardName=a),placeholder:"请输入奖项名称",maxlength:"50"},null,8,["modelValue"])])),_:1}),c(p,{class:"form-item"},{default:t((()=>[c(_,{class:"form-label"},{default:t((()=>[i("获奖级别"),c(_,{class:"required"},{default:t((()=>[i("*")])),_:1})])),_:1}),c(j,{class:"form-picker",range:H,value:I.value,onChange:M},{default:t((()=>[c(p,{class:"picker-text"},{default:t((()=>[i(m(q.value.level||"请选择获奖级别"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(p,{class:"form-item"},{default:t((()=>[c(_,{class:"form-label"},{default:t((()=>[i("颁发机构"),c(_,{class:"required"},{default:t((()=>[i("*")])),_:1})])),_:1}),c(N,{class:"form-input",type:"text",modelValue:q.value.organization,"onUpdate:modelValue":e[2]||(e[2]=a=>q.value.organization=a),placeholder:"请输入颁发机构",maxlength:"50"},null,8,["modelValue"])])),_:1}),c(p,{class:"form-item"},{default:t((()=>[c(_,{class:"form-label"},{default:t((()=>[i("获奖时间"),c(_,{class:"required"},{default:t((()=>[i("*")])),_:1})])),_:1}),c(j,{class:"form-picker",mode:"date",fields:"month",value:q.value.awardTime,onChange:O},{default:t((()=>[c(p,{class:"picker-text"},{default:t((()=>[i(m(q.value.awardTime||"请选择获奖时间"),1)])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),c(p,{class:"form-footer"},{default:t((()=>[c(z,{class:"cancel-btn",onClick:G},{default:t((()=>[i("取消")])),_:1}),c(z,{class:"confirm-btn",onClick:B},{default:t((()=>[i("确认")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-1cf5275f"]]);export{z as default};
