import{r as e,c as a,z as t,o as l,A as s,B as o,C as n,D as c,E as i,e as u,w as d,p as r,g as m,i as f,f as p,h as _,j as v,F as g,G as y,H as h,t as k,k as x,J as I,b as w,s as A,l as b,m as C,K as R,q as T,u as S,S as j,L as N,M as H,N as P,x as U,n as q}from"./index-DZtLzZ3A.js";import{_ as F}from"./uni-popup.DyDFSo5l.js";import{r as L}from"./uni-app.es.CpsDs8gT.js";import{t as z}from"./team.VNekZ19c.js";import{c as B}from"./competitions.CeqcXiK9.js";import{T as D}from"./TeamCard.DayT38NQ.js";import{T as M}from"./TabBar.D79MOQrs.js";import{H as $}from"./HeaderBar.3x7BGppL.js";import{_ as J}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./user.BA7q8pkn.js";const V=J({__name:"index",setup(J){const V=e(null);a((()=>V.value&&V.value.headerHeight?V.value.headerHeight+"rpx":"120rpx"));const O=e([]),E=e([]),G=e([]),K=e(""),Q=e(!1),W=e(null),X=e("希望加入您的团队，请审核"),Y=e(null),Z=e([]),ee=e(!1),ae=e(null),te=e(!1),le=["正在分析您的个人资料...","正在匹配与您技能相符的队伍...","正在计算兴趣匹配度...","正在生成个性化推荐..."];let se=null;const oe=e(0);async function ne(){try{const e=await B.getCompetitionsList({isHot:!0,pageSize:3});200===e.code&&e.data&&e.data.list&&(E.value=e.data.list,console.log("获取到热门竞赛数据:",E.value))}catch(e){console.error("获取竞赛数据失败:",e)}}async function ce(){try{const e=await z.getTeamList();200===e.code&&e.data&&e.data.list&&(O.value=e.data.list.slice(0,10),console.log("获取到队伍列表数据:",O.value))}catch(e){console.error("获取队伍数据失败:",e)}}async function ie(){try{if(G.value&&G.value.length>0)return void console.log("使用缓存的AI推荐队伍数据:",G.value);const a=await z.getRecommendedTeams();if(200===a.code&&a.data){const t=a.data.recommendedTeams||[];G.value=t.map((e=>({...e,matchScore:e.matchScore||Math.floor(30*Math.random())+70,matchReason:e.matchReason||e.recommendReason||"根据您的技能和兴趣推荐",recommendedRole:e.recommendedRole||""}))),K.value=a.data.aiSummary||"根据您的专业、技能和兴趣，我们为您推荐了以下最匹配的团队",console.log("获取到AI推荐队伍数据:",G.value);try{r("ai_recommended_teams",JSON.stringify(G.value)),r("ai_summary",K.value)}catch(e){console.error("缓存AI推荐数据失败:",e)}}}catch(a){console.error("获取AI推荐队伍失败:",a);try{const e=m("ai_recommended_teams"),a=m("ai_summary");e&&(G.value=JSON.parse(e),K.value=a||"",console.log("从缓存加载AI推荐队伍数据:",G.value))}catch(e){console.error("读取缓存AI推荐数据失败:",e)}}}function ue(e){"competition"===e?I({url:"/pages/competition/index"}):"task-square"===e?w({url:"/pages/task-square/index"}):"recommend"===e?de():A({title:`导航到${e}页面`,icon:"none"})}function de(){I({url:"/pages/team/recommended"})}function re(e,a){I("competition"===e?{url:`/pages/competition/detail?id=${a}`}:{url:`/pages/team/detail?id=${a}`})}async function me(e){try{ee.value=!0,W.value=e;const a=await z.checkTeamStatus(e);if(200===a.code&&a.data){if(a.data.isApplied)return void A({title:"您已经申请过该队伍",icon:"none"});if(a.data.isMember)return void A({title:"您已经是该队伍成员",icon:"none"})}const t=await z.getTeamDetail(e);if(200!==t.code||!t.data)return void A({title:"获取队伍信息失败",icon:"none"});if(Z.value=t.data.roles||[],0===Z.value.length)return void A({title:"该队伍暂无可申请的角色",icon:"none"});Z.value[0]&&(Y.value=Z.value[0].id),Q.value=!0}catch(a){A({title:"操作失败，请稍后重试",icon:"none"}),console.error("获取队伍角色失败:",a)}finally{ee.value=!1}}async function fe(){if(Y.value)if(X.value.trim())try{b({title:"提交中..."});const e=Z.value.find((e=>e.id===Y.value));if(e&&e.count<=e.filled)return C(),void A({title:"该角色已满员",icon:"none"});const a={teamId:Number(W.value),roleId:Number(Y.value),message:X.value.trim()};console.log("申请加入队伍:",a);const t=await z.applyTeam(a);C(),200===t.code?(A({title:"申请已发送",icon:"success"}),pe(),Q.value=!1):A({title:t.message||"申请失败",icon:"none"})}catch(e){C(),console.error("申请加入队伍失败:",e),A({title:e.message||"申请提交失败，请稍后重试",icon:"none"})}else A({title:"请输入申请留言",icon:"none"});else A({title:"请选择申请角色",icon:"none"})}function pe(){Q.value=!1,W.value=null,Y.value=null,X.value="希望加入您的团队，请审核",Z.value=[]}function _e(){I({url:"/pages/search/index"})}function ve(e){switch(e){case"0":return"status-not-started";case"1":return"status-recruiting";case"2":return"status-ongoing";case"3":return"status-ended";default:return""}}function ge(){if(c.getState("hasClickedAiRecommend"))return console.log("用户已点击过AI推荐，直接跳转到推荐页面"),void de();console.log("用户首次点击AI推荐，显示分析动画"),te.value=!0,oe.value=0;try{ae.value?ae.value.open():(console.error("AI推荐弹窗引用获取失败"),A({title:"正在分析中...",icon:"loading",mask:!0,duration:2e3}))}catch(e){console.error("打开AI弹窗失败:",e),b({title:le[0],mask:!0})}se&&(clearInterval(se),se=null),se=setInterval((()=>{oe.value=(oe.value+1)%le.length,ae.value&&ae.value.showPopup||b({title:le[oe.value],mask:!0}),oe.value===le.length-1&&setTimeout((()=>{clearInterval(se),se=null,C();try{ae.value&&ae.value.close()}catch(e){console.error("关闭AI弹窗失败:",e)}c.updateState("hasClickedAiRecommend",!0),A({title:"分析完成",icon:"success",duration:1e3}),setTimeout((()=>{de()}),1e3)}),1500)}),1500)}function ye(){console.log("关闭AI推荐弹窗"),se&&(clearInterval(se),se=null),C(),te.value=!1,oe.value=0}function he(e){ye(),re("team",e)}function ke(){console.log("重置AI推荐状态（开发测试用）"),c.resetAiRecommendState(),te.value=!1,oe.value=0,se&&(clearInterval(se),se=null),A({title:"已重置AI推荐状态",icon:"success",duration:1500})}return t(Q,(e=>{const a=R().in(n()).select(".uni-popup");a&&setTimeout((()=>{a.node((a=>{a&&a.node&&(e?a.node.open&&a.node.open():a.node.close&&a.node.close())})).exec()}),0)})),l((()=>{const e=s().statusBarHeight;console.log("状态栏高度:",e),o((()=>{try{const e=n();e&&e.proxy?(ae.value=e.proxy.$refs.aiRecommendPopup,console.log("获取到弹窗引用:",ae.value?"成功":"失败")):console.error("获取getCurrentInstance()失败或无proxy属性")}catch(e){console.error("获取弹窗引用出错:",e)}})),setTimeout((()=>{if(!ae.value)try{const e=n();e&&e.proxy&&(ae.value=e.proxy.$refs.aiRecommendPopup,console.log("延迟获取到弹窗引用:",ae.value?"成功":"失败"))}catch(e){console.error("延迟获取弹窗引用出错:",e)}}),300);const a=c.getState("hasClickedAiRecommend");console.log("用户是否已点击过AI推荐:",a?"是":"否"),a||(te.value=!1,oe.value=0,se&&(clearInterval(se),se=null)),Promise.all([ce(),ne(),ie()]).then((()=>{console.log("所有数据加载完成")})).catch((e=>{console.error("数据加载出错:",e)}))})),(e,a)=>{const t=T,l=S,s=f,o=j,n=N,c=H,r=P,m=U,w=L(i("uni-popup"),F);return p(),u(s,{class:"container"},{default:d((()=>[_($,{ref_key:"headerBarRef",ref:V,title:"校园任务与组队平台","show-ai-recommend":!0,onSearch:_e,onAiRecommend:de},null,512),_(c,{"scroll-y":"",class:"content-scroll"},{default:d((()=>[_(s,{class:"swiper-container"},{default:d((()=>[_(n,{class:"swiper animate__animated animate__fadeIn",circular:"",autoplay:"",interval:"3000",duration:"500","indicator-dots":"","indicator-active-color":"#247ae4","indicator-color":"rgba(0, 0, 0, 0.2)"},{default:d((()=>[_(o,null,{default:d((()=>[_(s,{class:"swiper-item"},{default:d((()=>[_(t,{src:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800",mode:"aspectFill"}),_(s,{class:"swiper-overlay"},{default:d((()=>[_(l,{class:"swiper-title"},{default:d((()=>[v("中国大学生计算机设计大赛(第18届)")])),_:1}),_(s,{class:"swiper-date"},{default:d((()=>[_(l,{class:"iconfont icon-calendar date-icon"}),_(l,{class:"date-text"},{default:d((()=>[v("报名截止：5月15日")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),_(o,null,{default:d((()=>[_(s,{class:"swiper-item"},{default:d((()=>[_(t,{src:"https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=800",mode:"aspectFill"}),_(s,{class:"swiper-overlay"},{default:d((()=>[_(l,{class:"swiper-title"},{default:d((()=>[v("挑战杯创业计划大赛")])),_:1}),_(s,{class:"swiper-date"},{default:d((()=>[_(l,{class:"iconfont icon-calendar date-icon"}),_(l,{class:"date-text"},{default:d((()=>[v("报名截止：6月10日")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),_(o,null,{default:d((()=>[_(s,{class:"swiper-item"},{default:d((()=>[_(t,{src:"https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800",mode:"aspectFill"}),_(s,{class:"swiper-overlay"},{default:d((()=>[_(l,{class:"swiper-title"},{default:d((()=>[v("创青春创业大赛")])),_:1}),_(s,{class:"swiper-date"},{default:d((()=>[_(l,{class:"iconfont icon-calendar date-icon"}),_(l,{class:"date-text"},{default:d((()=>[v("报名截止：7月5日")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),_(s,{class:"menu-container"},{default:d((()=>[_(s,{class:"menu-grid"},{default:d((()=>[_(s,{class:"menu-item animate__animated animate__fadeInUp",style:{"animation-delay":"0.1s"},onClick:a[0]||(a[0]=e=>ue("task-square"))},{default:d((()=>[_(s,{class:"menu-icon blue"},{default:d((()=>[_(l,{class:"iconfont icon-trophy"})])),_:1}),_(l,{class:"menu-text"},{default:d((()=>[v("校园委托")])),_:1})])),_:1}),_(s,{class:"menu-item animate__animated animate__fadeInUp",style:{"animation-delay":"0.2s"},onClick:a[1]||(a[1]=e=>ue("findPartner"))},{default:d((()=>[_(s,{class:"menu-icon green"},{default:d((()=>[_(l,{class:"iconfont icon-users"})])),_:1}),_(l,{class:"menu-text"},{default:d((()=>[v("寻找队友")])),_:1})])),_:1}),_(s,{class:"menu-item animate__animated animate__fadeInUp",style:{"animation-delay":"0.3s"},onClick:a[2]||(a[2]=e=>ue("project"))},{default:d((()=>[_(s,{class:"menu-icon purple"},{default:d((()=>[_(l,{class:"iconfont icon-project"})])),_:1}),_(l,{class:"menu-text"},{default:d((()=>[v("项目展示")])),_:1})])),_:1}),_(s,{class:"menu-item animate__animated animate__fadeInUp",style:{"animation-delay":"0.4s"},onClick:a[3]||(a[3]=e=>ue("schedule"))},{default:d((()=>[_(s,{class:"menu-icon orange"},{default:d((()=>[_(l,{class:"iconfont icon-calendar"})])),_:1}),_(l,{class:"menu-text"},{default:d((()=>[v("日程安排")])),_:1})])),_:1})])),_:1})])),_:1}),_(s,{class:"section"},{default:d((()=>[_(s,{class:"section-header"},{default:d((()=>[_(l,{class:"section-title animate__animated animate__fadeInLeft"},{default:d((()=>[v("热门竞赛")])),_:1}),_(l,{class:"view-all animate__animated animate__fadeInRight",onClick:a[4]||(a[4]=e=>{var a;I("competition"===(a="competition")?{url:"/pages/competition/index"}:"recommend"===a?{url:"/pages/team/recommended"}:{url:"/pages/team/list"})})},{default:d((()=>[v("查看全部")])),_:1})])),_:1}),_(s,{class:"competition-list"},{default:d((()=>[(p(!0),g(h,null,y(E.value,(e=>(p(),u(s,{class:"competition-item card-hover animate__animated animate__fadeInUp",style:{"animation-delay":"0.1s"},onClick:a=>re("competition",e.id),key:e.id},{default:d((()=>[_(s,{class:"competition-flex"},{default:d((()=>[_(s,{class:"competition-image-container"},{default:d((()=>[_(t,{class:"competition-image",src:e.coverImageUrl||"https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=800",mode:"aspectFill"},null,8,["src"])])),_:2},1024),_(s,{class:"competition-content"},{default:d((()=>[_(s,{class:"flex-between"},{default:d((()=>[_(l,{class:"competition-title"},{default:d((()=>[v(k(e.title),1)])),_:2},1024),_(s,{class:"status-wrapper"},{default:d((()=>[_(l,{class:q(["status-tag pulse",ve(e.status)])},{default:d((()=>[v(k(e.statusText),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),_(s,{class:"tag-row"},{default:d((()=>[e.categoryNames&&e.categoryNames.length>0?(p(),u(l,{key:0,class:"tag green-tag"},{default:d((()=>[v(k(e.categoryNames[0]),1)])),_:2},1024)):x("",!0),_(l,{class:"tag gray-tag"},{default:d((()=>[v(k(e.level),1)])),_:2},1024)])),_:2},1024),_(s,{class:"competition-info"},{default:d((()=>[_(s,{class:"info-item"},{default:d((()=>[_(l,{class:"iconfont icon-clock"}),_(l,{class:"info-text"},{default:d((()=>[v("报名截止: "+k(e.registrationDeadlineFormatted),1)])),_:2},1024)])),_:2},1024),_(s,{class:"info-item"},{default:d((()=>[_(l,{class:"iconfont icon-team"}),_(l,{class:"info-text"},{default:d((()=>[v(k(e.teamSize)+"-"+k(e.teamMax)+"人/队",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),_(s,{class:"section"},{default:d((()=>[_(s,{class:"section-header"},{default:d((()=>[_(l,{class:"section-title animate__animated animate__fadeInLeft"},{default:d((()=>[v("热门队伍")])),_:1}),_(s,{class:"ai-recommend-btn",onClick:ge,onLongpress:ke},{default:d((()=>[_(l,{class:"iconfont icon-ai"}),_(l,{class:"ai-text"},{default:d((()=>[v("AI智能推荐")])),_:1})])),_:1})])),_:1}),_(s,{class:"team-list"},{default:d((()=>[O.value.length>0?(p(!0),g(h,{key:0},y(O.value,((e,t)=>(p(),u(D,{key:e.id,team:e,index:t,onDetail:a[5]||(a[5]=e=>re("team",e)),onApply:me},null,8,["team","index"])))),128)):(p(),u(s,{key:1,class:"empty-state"},{default:d((()=>[_(l,{class:"empty-text"},{default:d((()=>[v("加载中...")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),_(M,{activeTab:"home"}),_(w,{ref:"applyPopup",type:"center",show:Q.value,onChange:a[9]||(a[9]=e=>{e.show||pe()})},{default:d((()=>[_(s,{class:"apply-popup"},{default:d((()=>[_(s,{class:"popup-header"},{default:d((()=>[_(l,{class:"popup-title"},{default:d((()=>[v("申请加入团队")])),_:1}),_(l,{class:"close-icon",onClick:a[6]||(a[6]=e=>Q.value=!1)},{default:d((()=>[v("×")])),_:1})])),_:1}),_(s,{class:"popup-content"},{default:d((()=>[_(s,{class:"form-item"},{default:d((()=>[_(l,{class:"form-label"},{default:d((()=>[v("申请角色")])),_:1}),_(s,{class:"role-select"},{default:d((()=>[(p(!0),g(h,null,y(Z.value,(e=>(p(),u(s,{key:e.id,class:q(["role-option",Y.value===e.id?"role-selected":""]),onClick:a=>Y.value=e.id},{default:d((()=>[_(l,{class:"role-name"},{default:d((()=>[v(k(e.name),1)])),_:2},1024),_(l,{class:"role-count"},{default:d((()=>[v(k(e.filled)+"/"+k(e.count)+"人",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),_(s,{class:"form-item"},{default:d((()=>[_(l,{class:"form-label"},{default:d((()=>[v("申请留言 "),_(l,{class:"required"},{default:d((()=>[v("*")])),_:1})])),_:1}),_(r,{class:"message-input",modelValue:X.value,"onUpdate:modelValue":a[7]||(a[7]=e=>X.value=e),placeholder:"请输入申请留言",maxlength:"100"},null,8,["modelValue"]),_(l,{class:"char-count"},{default:d((()=>[v(k(X.value.length)+"/100",1)])),_:1})])),_:1})])),_:1}),_(s,{class:"popup-footer"},{default:d((()=>[_(m,{class:"cancel-btn",onClick:a[8]||(a[8]=e=>Q.value=!1)},{default:d((()=>[v("取消")])),_:1}),_(m,{class:"submit-btn",onClick:fe,disabled:!X.value},{default:d((()=>[v("提交申请")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1},8,["show"]),_(w,{ref_key:"aiRecommendPopup",ref:ae,type:"center"},{default:d((()=>[_(s,{class:"ai-popup"},{default:d((()=>[_(s,{class:"popup-header"},{default:d((()=>[_(l,{class:"popup-title"},{default:d((()=>[v("AI智能推荐")])),_:1}),_(l,{class:"close-icon",onClick:ye},{default:d((()=>[v("×")])),_:1})])),_:1}),_(s,{class:"popup-content"},{default:d((()=>[te.value?(p(),u(s,{key:0,class:"ai-analyzing"},{default:d((()=>[_(s,{class:"ai-icon-container"},{default:d((()=>[_(l,{class:"iconfont icon-ai ai-icon"})])),_:1}),_(s,{class:"analyzing-text"},{default:d((()=>[_(l,null,{default:d((()=>[v(k(le[oe.value]),1)])),_:1})])),_:1}),_(s,{class:"loading-dots"},{default:d((()=>[_(s,{class:"dot"}),_(s,{class:"dot"}),_(s,{class:"dot"})])),_:1})])),_:1})):(p(),u(s,{key:1},{default:d((()=>[K.value?(p(),u(s,{key:0,class:"ai-summary"},{default:d((()=>[_(s,{class:"summary-header"},{default:d((()=>[_(l,{class:"summary-title"},{default:d((()=>[v("✨ AI分析结果")])),_:1})])),_:1}),_(l,{class:"summary-content"},{default:d((()=>[v(k(K.value),1)])),_:1})])),_:1})):x("",!0),_(c,{class:"recommend-teams-scroll","scroll-y":""},{default:d((()=>[G.value.length>0?(p(),u(s,{key:0,class:"recommend-teams"},{default:d((()=>[(p(!0),g(h,null,y(G.value.slice(0,3),((e,a)=>(p(),u(D,{key:e.id,team:e,index:a,"show-match":!0,onDetail:he,onApply:me},null,8,["team","index"])))),128))])),_:1})):(p(),u(s,{key:1,class:"empty-recommend"},{default:d((()=>[_(l,null,{default:d((()=>[v("暂无推荐结果，请完善个人资料后再试")])),_:1})])),_:1}))])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-8d740e73"]]);export{V as default};
