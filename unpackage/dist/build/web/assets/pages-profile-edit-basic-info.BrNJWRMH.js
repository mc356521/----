import{r as e,c as a,o as l,e as s,w as o,s as t,i as c,f as n,h as u,j as r,t as i,l as d,m as f,T as m,u as v,I as _,y as h,M as p}from"./index-DZtLzZ3A.js";import{u as g}from"./user.BA7q8pkn.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=y({__name:"edit-basic-info",setup(y){const b=e({realName:"",phoneNumber:"",schoolId:null,schoolName:"",major:"",studentTeacherId:""}),N=e(!0),x=e([]),I=a((()=>{if(!b.value.schoolId||0===x.value.length)return 0;const e=x.value.findIndex((e=>e.id===b.value.schoolId));return e>=0?e:0})),k=a((()=>b.value.schoolName||"请选择学校"));async function j(){try{N.value=!0;const e=await g.getUserProfile();200===e.code&&e.data?(b.value=e.data,console.log("获取到用户资料:",b.value),await async function(){try{const e=await g.getSchools();200===e.code&&e.data?x.value=e.data:console.error("获取学校列表失败:",e.message)}catch(e){console.error("获取学校列表失败:",e)}}()):t({title:e.message||"获取资料失败",icon:"none"})}catch(e){console.error("获取用户资料失败:",e),t({title:"获取个人资料失败",icon:"none"})}finally{N.value=!1}}function w(e){const a=e.detail.value;if(a>=0&&a<x.value.length){const e=x.value[a];b.value.schoolId=e.id,b.value.schoolName=e.name}}async function V(){if(b.value.realName&&""!==b.value.realName.trim())if(b.value.schoolId)try{d({title:"保存中..."});const e={realName:b.value.realName,schoolId:b.value.schoolId,major:b.value.major,bio:b.value.bio,skillTags:b.value.skillTags||[],awardsHistory:b.value.awardsHistory||[]},a=await g.updateUserProfile(e);200===a.code?(t({title:"保存成功",icon:"success"}),setTimeout((()=>{T()}),1500)):t({title:a.message||"保存失败",icon:"none"})}catch(e){console.error("保存用户资料失败:",e),t({title:"保存失败，请稍后再试",icon:"none"})}finally{f()}else t({title:"请选择学校",icon:"none"});else t({title:"姓名不能为空",icon:"none"})}function T(){m()}return l((()=>{j()})),(e,a)=>{const l=v,t=c,d=_,f=h,m=p;return n(),s(t,{class:"container"},{default:o((()=>[u(t,{class:"header"},{default:o((()=>[u(t,{class:"back-btn",onClick:T},{default:o((()=>[u(l,{class:"iconfont icon-arrow-left"})])),_:1}),u(l,{class:"header-title"},{default:o((()=>[r("编辑基本信息")])),_:1}),u(t,{class:"save-btn",onClick:V},{default:o((()=>[u(l,null,{default:o((()=>[r("保存")])),_:1})])),_:1})])),_:1}),N.value?(n(),s(t,{key:0,class:"loading-container"},{default:o((()=>[u(t,{class:"loading-circle"}),u(l,{class:"loading-text"},{default:o((()=>[r("加载中...")])),_:1})])),_:1})):(n(),s(m,{key:1,"scroll-y":"",class:"content-scroll"},{default:o((()=>[u(t,{class:"form-section"},{default:o((()=>[u(t,{class:"form-item"},{default:o((()=>[u(l,{class:"form-label"},{default:o((()=>[r("姓名")])),_:1}),u(d,{class:"form-input",type:"text",modelValue:b.value.realName,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value.realName=e),placeholder:"请输入真实姓名",maxlength:"20"},null,8,["modelValue"])])),_:1}),u(t,{class:"form-item"},{default:o((()=>[u(l,{class:"form-label"},{default:o((()=>[r("学校")])),_:1}),u(f,{class:"form-picker",range:x.value,"range-key":"name",value:I.value,onChange:w},{default:o((()=>[u(t,{class:"picker-text"},{default:o((()=>[r(i(k.value||"请选择学校"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),u(t,{class:"form-item"},{default:o((()=>[u(l,{class:"form-label"},{default:o((()=>[r("专业")])),_:1}),u(d,{class:"form-input",type:"text",modelValue:b.value.major,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value.major=e),placeholder:"请输入专业",maxlength:"30"},null,8,["modelValue"])])),_:1}),u(t,{class:"form-item form-item-last"},{default:o((()=>[u(l,{class:"form-label"},{default:o((()=>[r("手机号")])),_:1}),u(t,{class:"form-text"},{default:o((()=>[r(i(b.value.phoneNumber||"未设置"),1)])),_:1})])),_:1})])),_:1}),u(l,{class:"form-tip"},{default:o((()=>[r("注意：学号和角色信息不可修改")])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-395c2df3"]]);export{b as default};
