import{s as t,P as e,J as a,b as s,a1 as i,a7 as o,e as r,w as n,i as l,f as c,h as d,Q as h,j as u,F as g,G as p,H as m,k as f,u as C,L as y,M as _,t as x,n as H,q as w,S as b}from"./index-DZtLzZ3A.js";import{T as L}from"./TabBar.D79MOQrs.js";import{a as S}from"./index.BRmG1gro.js";import{H as k}from"./HeaderBar.3x7BGppL.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./user.BA7q8pkn.js";import"./team.VNekZ19c.js";import"./competitions.CeqcXiK9.js";import"./taskApplications.MAaxBfY8.js";const v=T({components:{TabBar:L,HeaderBar:k},data:()=>({categories:["全部竞赛","学科竞赛","创新创业","科技竞赛","文体竞赛"],currentCategory:0,loading:!1,hasMore:!0,currentPage:1,pageSize:10,hotCompetitions:[],competitionList:[],currentHotIndex:0,headerPlaceholderHeight:"200rpx"}),onLoad(){this.getHotCompetitions(),this.getCompetitionList(),this.updateHeaderHeight()},mounted(){setTimeout((()=>{this.updateHeaderHeight()}),300)},onPullDownRefresh(){this.onRefresh()},onReachBottom(){this.loadMore()},methods:{updateHeaderHeight(){const t=this.$refs.headerBarRef;t&&t.headerHeight?this.headerPlaceholderHeight=t.headerHeight+"rpx":this.headerPlaceholderHeight=this.categories.length>0?"200rpx":"120rpx"},onSwiperChange(t){this.currentHotIndex=t.detail.current},switchToSlide(t){this.currentHotIndex=t},async getHotCompetitions(){try{this.loading=!0;const t=await S.competitions.getCompetitionsList({pageSize:3,isHot:!0});t&&200===t.code&&t.data&&Array.isArray(t.data.list)&&(this.hotCompetitions=t.data.list)}catch(e){console.error("获取热门竞赛失败:",e),t({title:"获取热门竞赛失败",icon:"none"}),this.hotCompetitions=[]}finally{this.loading=!1}},async getCompetitionList(e=!0){try{if(e&&(this.currentPage=1,this.competitionList=[]),!this.hasMore&&!e)return;this.loading=!0;const a={pageNum:this.currentPage,pageSize:this.pageSize};if(this.currentCategory>0){const t=[null,1,2,3,4];a.categoryId=t[this.currentCategory]}const s=await S.competitions.getCompetitionsList(a);s&&200===s.code&&s.data&&(e?this.competitionList=Array.isArray(s.data.list)?s.data.list:[]:Array.isArray(s.data.list)&&(this.competitionList=[...this.competitionList,...s.data.list]),this.hasMore=s.data.hasNext||!1,0===this.competitionList.length&&t({title:"暂无竞赛数据",icon:"none"}))}catch(a){console.error("获取竞赛列表失败:",a),t({title:"获取竞赛列表失败",icon:"none"}),e&&(this.competitionList=[])}finally{this.loading=!1}},loadMore(){!this.loading&&this.hasMore&&(this.currentPage++,this.getCompetitionList(!1))},onRefresh(){this.getCompetitionList(!0),this.getHotCompetitions(),e()},getCategoryClass(t){switch(t){case"创新创业":return"tag-orange";case"学科竞赛":return"tag-green";case"科技竞赛":return"tag-blue";case"文体竞赛":return"tag-purple";default:return""}},getStatusClass(t){switch(t){case"0":return"status-upcoming";case"1":return"status-active";case"2":return"status-ongoing";case"3":return"status-ended";default:return""}},formatDate(t){if(!t)return"";const e=new Date(t);return`${e.getMonth()+1}月${e.getDate()}日`},isUpcoming:t=>"0"===t.status,selectCategory(t){this.currentCategory!==t&&(this.currentCategory=t,this.getCompetitionList(!0))},viewDetail(t){a({url:`/pages/competition/detail?id=${t}`})},handleTabChange(t){"home"===t?s({url:"/pages/index/index"}):"team"===t?s({url:"/pages/team/list"}):"profile"===t&&s({url:"/pages/profile/index"})},goToNotification(){a({url:"/pages/Xiaoxi/Xiaoxi"})},goToSearch(){a({url:"/pages/search/index"})},showPublishOptions(){i({itemList:["发布竞赛信息","招募队友","发布项目展示"],success:function(e){t({title:`选择了: ${e.tapIndex}`,icon:"none"})}})},getActionText(t){switch(t){case"0":return"提醒我";case"1":case"2":default:return"查看详情";case"3":return"查看结果"}}}},[["render",function(t,e,a,s,i,L){const S=o("header-bar"),k=l,T=C,v=w,P=b,D=y,M=_,j=o("tab-bar");return c(),r(k,{class:"container",ref:"instance"},{default:n((()=>[d(S,{ref:"headerBarRef",title:"竞赛广场",categories:i.categories,"default-category":i.currentCategory,"show-filter":"true",onSearch:L.goToSearch,onFilter:L.goToNotification,onCategoryChange:L.selectCategory},null,8,["categories","default-category","onSearch","onFilter","onCategoryChange"]),d(k,{class:"header-placeholder",style:h({height:i.headerPlaceholderHeight})},null,8,["style"]),d(M,{"scroll-y":"true",class:"competition-content",onScrolltolower:L.loadMore},{default:n((()=>[i.hotCompetitions&&i.hotCompetitions.length>0?(c(),r(k,{key:0,class:"section"},{default:n((()=>[d(k,{class:"section-header"},{default:n((()=>[d(T,{class:"section-title"},{default:n((()=>[u("热门竞赛")])),_:1})])),_:1}),d(D,{class:"hot-swiper",indicator:!1,autoplay:!0,interval:3e3,duration:500,circular:!0,current:i.currentHotIndex,onChange:L.onSwiperChange},{default:n((()=>[(c(!0),g(m,null,p(i.hotCompetitions,((t,e)=>(c(),r(P,{key:e,class:"hot-swiper-item"},{default:n((()=>[d(k,{class:"hot-item",onClick:e=>L.viewDetail(t.id)},{default:n((()=>[d(v,{class:"hot-img",src:t.coverImageUrl,mode:"aspectFill"},null,8,["src"]),d(k,{class:"hot-overlay"},{default:n((()=>[d(T,{class:"hot-title"},{default:n((()=>[u(x(t.title),1)])),_:2},1024),d(T,{class:"hot-desc"},{default:n((()=>[u(x(t.shortDescription),1)])),_:2},1024),d(k,{class:"hot-info"},{default:n((()=>[d(k,{class:"hot-info-item"},{default:n((()=>[d(T,{class:"iconfont icon-calendar"}),d(T,{class:"hot-date"},{default:n((()=>[u("报名截止: "+x(L.formatDate(t.registrationDeadline)),1)])),_:2},1024)])),_:2},1024),d(k,{class:"hot-info-item"},{default:n((()=>[d(T,{class:"iconfont icon-team"}),d(T,{class:"hot-team"},{default:n((()=>[u(x(t.teamSize)+"~"+x(t.teamMax)+"人",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["current","onChange"]),d(k,{class:"dots-container"},{default:n((()=>[(c(!0),g(m,null,p(i.hotCompetitions,((t,e)=>(c(),r(k,{key:e,class:H(["dot",{"active-dot":i.currentHotIndex===e}]),onClick:t=>L.switchToSlide(e)},null,8,["class","onClick"])))),128))])),_:1})])),_:1})):f("",!0),d(k,{class:"section"},{default:n((()=>[d(k,{class:"section-header"},{default:n((()=>[d(T,{class:"section-title"},{default:n((()=>[u("最新竞赛")])),_:1})])),_:1}),d(k,{class:"competition-list"},{default:n((()=>[(c(!0),g(m,null,p(i.competitionList,((t,e)=>(c(),r(k,{class:"competition-card",key:e,onClick:e=>L.viewDetail(t.id)},{default:n((()=>[d(k,{class:"card-image-wrapper"},{default:n((()=>[d(v,{class:"card-image",src:t.coverImageUrl,mode:"aspectFill"},null,8,["src"]),d(k,{class:H(["status-badge",L.getStatusClass(t.status)])},{default:n((()=>[u(x(t.statusText),1)])),_:2},1032,["class"])])),_:2},1024),d(k,{class:"card-content"},{default:n((()=>[d(T,{class:"card-title"},{default:n((()=>[u(x(t.title),1)])),_:2},1024),d(T,{class:"card-desc"},{default:n((()=>[u(x(t.shortDescription),1)])),_:2},1024),d(k,{class:"card-tags"},{default:n((()=>[d(T,{class:H(["category-tag",L.getCategoryClass(t.categoryName)])},{default:n((()=>[u(x(t.categoryName),1)])),_:2},1032,["class"]),d(T,{class:"level-tag"},{default:n((()=>[u(x(t.level),1)])),_:2},1024),d(T,{class:"team-tag"},{default:n((()=>[d(T,{class:"iconfont icon-team"}),u(" "+x(t.teamSize)+"~"+x(t.teamMax)+"人 ",1)])),_:2},1024)])),_:2},1024),d(k,{class:"card-footer"},{default:n((()=>[d(k,{class:"date-info"},{default:n((()=>[d(T,{class:"iconfont icon-calendar"}),d(T,{class:"date-text"},{default:n((()=>[u(x(L.isUpcoming(t)?"报名开始":"报名截止")+": "+x(L.formatDate(L.isUpcoming(t)?t.registrationStart:t.registrationDeadline)),1)])),_:2},1024)])),_:2},1024),d(k,{class:H(["action-btn",{"disabled-btn":"0"===t.status||"3"===t.status}])},{default:n((()=>[u(x(L.getActionText(t.status)),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),i.competitionList.length>0?(c(),r(k,{key:0,class:"loading-more"},{default:n((()=>[i.loading?(c(),r(T,{key:0},{default:n((()=>[u("加载中...")])),_:1})):i.hasMore?(c(),r(T,{key:1,onClick:L.loadMore},{default:n((()=>[u("点击加载更多")])),_:1},8,["onClick"])):(c(),r(T,{key:2},{default:n((()=>[u("没有更多竞赛了")])),_:1}))])),_:1})):f("",!0),0!==i.competitionList.length||i.loading?f("",!0):(c(),r(k,{key:1,class:"empty-state"},{default:n((()=>[d(T,{class:"empty-text"},{default:n((()=>[u("暂无竞赛数据")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1},8,["onScrolltolower"]),d(j,{"active-tab":"competition",onTabChange:L.handleTabChange,onPublish:L.showPublishOptions},null,8,["onTabChange","onPublish"])])),_:1},512)}],["__scopeId","data-v-61e73d53"]]);export{v as default};
