import{s as e,T as t,g as a,W as s,J as o,V as n,a1 as c,e as l,w as i,i as r,f as d,h as u,j as f,t as m,n as h,k as I,F as p,G as _,H as g,u as y,q as b,x as k}from"./index-DZtLzZ3A.js";import{t as T}from"./team.VNekZ19c.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=C({data:()=>({defaultAvatar:"/static/images/default-avatar.png",teamId:null,teamInfo:{},teamMembers:[],showPhone:!1,isLoading:!0,userInfo:null,hasApplied:!1,isTeamMember:!1,isTeamLeader:!1,applyLoading:!1}),computed:{hasAvailableRoles(){return!!this.teamInfo.roles&&this.teamInfo.roles.some((e=>e.currentCount<e.requiredCount))}},onLoad(a){console.log("队伍详情页面参数:",a),a&&a.id?(this.teamId=a.id,this.getUserInfo(),this.getTeamDetail()):(e({title:"队伍ID不能为空",icon:"none"}),setTimeout((()=>{t()}),1500))},onShow(){this.getUserInfo(),this.teamId&&this.checkTeamStatus()},methods:{getUserInfo(){const e=a("userInfo");e&&(this.userInfo="string"==typeof e?JSON.parse(e):e)},async checkTeamStatus(){if(this.userInfo&&this.userInfo.userId)try{const e=await T.checkTeamStatus(this.teamId);200===e.code&&(this.hasApplied=!0===e.data)}catch(e){console.error("检查团队状态失败",e)}},getStatusClass(e){switch(e){case"0":default:return"status-recruiting";case"1":return"status-filled";case"2":return"status-disbanded"}},getStatusIcon(e){switch(e){case"0":default:return"icon-check-circle";case"1":return"icon-hourglass";case"2":return"icon-times-circle"}},hidePhone:e=>e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"",togglePhone(){this.showPhone=!this.showPhone},copyText(t){s({data:t,success:()=>{e({title:"复制成功",icon:"success"})}})},goBack(){t()},goToCompetition(e){e&&o({url:`/pages/competition/detail?id=${e}`})},async applyRole(t){this.hasApplied?e({title:"您已申请或已加入该团队",icon:"none"}):n({title:"申请加入理由",content:"",editable:!0,placeholderText:"我希望加入团队参与...",success:async a=>{if(a.confirm){const c=a.content||"希望能加入团队，与大家一起学习成长。";this.applyLoading=!0;try{const a={teamId:this.teamId,roleId:t,message:c},s=await T.applyTeam(a);200===s.code?(e({title:"申请已提交",icon:"success"}),this.hasApplied=!0,setTimeout((()=>{n({title:"申请已提交",content:"您可以在申请管理中查看申请状态",confirmText:"查看申请",cancelText:"稍后再看",success:e=>{e.confirm&&o({url:"/pages/team/applications"})}})}),1500)):e({title:s.message||"申请提交失败",icon:"none"})}catch(s){console.error("申请失败",s),e({title:"网络异常，请稍后重试",icon:"none"})}finally{this.applyLoading=!1}}}})},showApplyOptions(){if(this.userInfo&&this.userInfo.userId)if(this.hasApplied)e({title:"您已申请或已加入该团队",icon:"none"});else if(this.teamInfo.roles&&this.teamInfo.roles.length>0){const t=this.teamInfo.roles.filter((e=>e.currentCount<e.requiredCount));if(t.length>1){const e=t.map((e=>`${e.name}（${e.currentCount}/${e.requiredCount}）`));c({itemList:e,success:e=>{this.applyRole(t[e.tapIndex].id)}})}else 1===t.length?this.applyRole(t[0].id):e({title:"当前没有可申请的角色",icon:"none"})}else e({title:"当前没有可申请的角色",icon:"none"});else n({title:"提示",content:"请先登录后再申请加入团队",confirmText:"去登录",success:e=>{e.confirm&&o({url:"/pages/login/login"})}})},editTeam(){o({url:`/pages/team/edit?id=${this.teamId}`})},async disbandTeam(){n({title:"解散队伍",content:"确定要解散该队伍吗？此操作不可撤销",confirmColor:"#f56c6c",success:async a=>{if(a.confirm)try{const a=await T.disbandTeam(this.teamId);200===a.code?(e({title:"队伍已解散",icon:"success"}),setTimeout((()=>{t()}),1500)):e({title:a.message||"解散队伍失败",icon:"none"})}catch(s){console.error("解散队伍失败",s),e({title:"网络异常，请稍后重试",icon:"none"})}}})},async leaveTeam(){n({title:"退出队伍",content:"确定要退出该队伍吗？",confirmColor:"#f56c6c",success:async a=>{if(a.confirm)try{const a=await T.leaveTeam(this.teamId);200===a.code?(e({title:"已退出队伍",icon:"success"}),setTimeout((()=>{t()}),1500)):e({title:a.message||"退出失败",icon:"none"})}catch(s){console.error("退出队伍失败",s),e({title:"网络异常，请稍后重试",icon:"none"})}}})},async getTeamMembers(){try{const e=await T.getTeamMembers(this.teamId);if(e&&200===e.code&&e.data){if(this.teamMembers=e.data,this.userInfo&&this.userInfo.userId){const e=this.userInfo.userId,t=this.teamMembers.some((t=>t.userId===e)),a=t&&this.teamMembers.some((t=>t.userId===e&&t.isLeader));this.isTeamMember=t,this.isTeamLeader=a}console.log("获取到队伍成员:",this.teamMembers)}else console.log("获取队伍成员失败:",null==e?void 0:e.message)}catch(e){console.error("获取队伍成员出错",e)}},async getTeamDetail(){this.isLoading=!0;try{const t=await T.getTeamDetail(this.teamId);t&&200===t.code&&t.data?(this.teamInfo=t.data,console.log("获取到队伍详情:",this.teamInfo),this.userInfo&&this.userInfo.userId&&this.teamInfo.leaderId===this.userInfo.userId&&(this.isTeamLeader=!0,this.isTeamMember=!0),this.getTeamMembers(),this.checkTeamStatus()):(e({title:(null==t?void 0:t.message)||"获取队伍详情失败",icon:"none"}),console.log("获取队伍详情失败:",t))}catch(t){console.error("获取队伍详情出错",t),e({title:"网络异常，请稍后重试",icon:"none"})}finally{this.isLoading=!1}}}},[["render",function(e,t,a,s,o,n){const c=y,T=r,C=b,w=k;return d(),l(T,{class:"container"},{default:i((()=>[u(T,{class:"top-bar"},{default:i((()=>[u(T,{class:"flex-between px-4 py-3"},{default:i((()=>[u(T,{class:"back-btn",onClick:n.goBack},{default:i((()=>[u(c,{class:"iconfont icon-arrow-left"})])),_:1},8,["onClick"]),u(c,{class:"page-title"},{default:i((()=>[f(m(o.teamInfo.name||"队伍详情"),1)])),_:1}),u(T,{class:"header-actions"},{default:i((()=>[u(c,{class:"iconfont icon-star mr-3"}),u(c,{class:"iconfont icon-share"})])),_:1})])),_:1})])),_:1}),u(T,{class:"info-card"},{default:i((()=>[u(T,{class:"flex-between mb-3"},{default:i((()=>[u(T,{class:"competition-link",onClick:t[0]||(t[0]=e=>n.goToCompetition(o.teamInfo.competitionId))},{default:i((()=>[u(c,{class:"iconfont icon-trophy mr-1 blue-text"}),u(T,{class:"blue-text"},{default:i((()=>[f("关联竞赛："+m(o.teamInfo.competitionName),1)])),_:1})])),_:1})])),_:1}),u(T,{class:"leader-info"},{default:i((()=>[u(C,{class:"leader-avatar",src:o.teamInfo.leaderAvatarUrl||o.defaultAvatar},null,8,["src"]),u(T,{class:"leader-detail"},{default:i((()=>[u(c,{class:"leader-name"},{default:i((()=>[f("队长："+m(o.teamInfo.leaderName),1)])),_:1}),u(c,{class:"leader-major"},{default:i((()=>[f(m(o.teamInfo.leaderMajor||"未设置专业"),1)])),_:1})])),_:1}),u(T,{class:h(["status-tag",n.getStatusClass(o.teamInfo.status)])},{default:i((()=>[u(c,null,{default:i((()=>[f(m(o.teamInfo.statusText),1)])),_:1})])),_:1},8,["class"])])),_:1}),o.teamInfo.direction?(d(),l(T,{key:0,class:"research-direction"},{default:i((()=>[u(c,{class:"section-title"},{default:i((()=>[f("队伍方向")])),_:1}),u(c,{class:"desc-text"},{default:i((()=>[f(m(o.teamInfo.direction),1)])),_:1})])),_:1})):I("",!0),u(T,{class:"team-desc-section"},{default:i((()=>[u(c,{class:"section-title"},{default:i((()=>[f("队伍描述")])),_:1}),u(c,{class:"desc-text"},{default:i((()=>[f(m(o.teamInfo.description),1)])),_:1})])),_:1}),u(T,{class:"team-meta"},{default:i((()=>[u(c,{class:"meta-item"},{default:i((()=>[f("组队截止："+m(o.teamInfo.recruitmentDeadlineFormatted),1)])),_:1}),u(T,{class:"view-count"},{default:i((()=>[u(c,{class:"iconfont icon-eye"}),u(c,null,{default:i((()=>[f("浏览次数："+m(o.teamInfo.viewCount),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(T,{class:"section-card"},{default:i((()=>[u(c,{class:"section-header"},{default:i((()=>[f("招募角色")])),_:1}),u(T,{class:"role-list"},{default:i((()=>[(d(!0),p(g,null,_(o.teamInfo.roles,(e=>(d(),l(T,{class:h(["role-card",{"role-filled":e.currentCount>=e.requiredCount}]),key:e.id},{default:i((()=>[u(T,{class:"flex-between mb-2"},{default:i((()=>[u(T,null,{default:i((()=>[u(c,{class:"role-title"},{default:i((()=>[f(m(e.name),1)])),_:2},1024),u(c,{class:"role-count"},{default:i((()=>[f("需求："+m(e.requiredCount)+"人 / 已招募："+m(e.currentCount)+"人",1)])),_:2},1024)])),_:2},1024),u(T,{class:h(["role-status-tag",e.currentCount>=e.requiredCount?"filled-tag":"recruiting-tag"])},{default:i((()=>[f(m(e.currentCount>=e.requiredCount?"已满员":"招募中"),1)])),_:2},1032,["class"])])),_:2},1024),u(c,{class:"role-desc"},{default:i((()=>[f(m(e.description),1)])),_:2},1024),u(T,{class:"skill-section"},{default:i((()=>[u(c,{class:"skill-header"},{default:i((()=>[f("技能要求:")])),_:1}),u(T,{class:"skill-tags"},{default:i((()=>[(d(!0),p(g,null,_(e.skillRequirements,((e,t)=>(d(),l(c,{class:"skill-tag",key:t},{default:i((()=>[f(m(e),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),u(w,{class:h(["apply-btn",e.currentCount>=e.requiredCount?"disabled-btn":"active-btn"]),disabled:e.currentCount>=e.requiredCount,onClick:t=>n.applyRole(e.id)},{default:i((()=>[e.currentCount<e.requiredCount?(d(),l(c,{key:0,class:"iconfont icon-paper-plane"})):I("",!0),f(" 申请加入 ")])),_:2},1032,["class","disabled","onClick"])])),_:2},1032,["class"])))),128))])),_:1})])),_:1}),o.teamMembers.length>0?(d(),l(T,{key:0,class:"info-card"},{default:i((()=>[u(c,{class:"section-header"},{default:i((()=>[f("队伍成员 ("+m(o.teamMembers.length)+")",1)])),_:1}),u(T,{class:"member-grid"},{default:i((()=>[(d(!0),p(g,null,_(o.teamMembers,((e,t)=>(d(),l(T,{class:"member-item",key:t},{default:i((()=>[u(C,{class:h(["member-avatar",{"leader-border2":e.isLeader}]),src:e.userAvatarUrl||o.defaultAvatar},null,8,["src","class"]),u(c,{class:"member-name"},{default:i((()=>[f(m(e.userName)+" ",1),e.roleName?(d(),l(T,{key:0,class:"member-role"},{default:i((()=>[f("("+m(e.roleName)+")",1)])),_:2},1024)):I("",!0),e.isLeader?(d(),l(T,{key:1,class:"leader-label"},{default:i((()=>[f("(队长)")])),_:1})):I("",!0)])),_:2},1024),e.userMajor?(d(),l(c,{key:0,class:"member-major"},{default:i((()=>[f(m(e.userMajor),1)])),_:2},1024)):I("",!0)])),_:2},1024)))),128))])),_:1})])),_:1})):I("",!0),o.teamInfo.teachers&&o.teamInfo.teachers.length>0?(d(),l(T,{key:1,class:"info-card"},{default:i((()=>[u(c,{class:"section-header"},{default:i((()=>[f("指导老师")])),_:1}),u(T,{class:"member-grid"},{default:i((()=>[(d(!0),p(g,null,_(o.teamInfo.teachers,((e,t)=>(d(),l(T,{class:"member-item",key:t},{default:i((()=>[u(C,{class:"member-avatar",src:e.avatarUrl||o.defaultAvatar},null,8,["src"]),u(c,{class:"member-name"},{default:i((()=>[f(m(e.name),1)])),_:2},1024),e.major?(d(),l(c,{key:0,class:"teacher-major"},{default:i((()=>[f(m(e.major),1)])),_:2},1024)):I("",!0)])),_:2},1024)))),128))])),_:1})])),_:1})):I("",!0),o.teamInfo.contactInfo?(d(),l(T,{key:2,class:"info-card"},{default:i((()=>[u(c,{class:"section-header"},{default:i((()=>[f("联系方式")])),_:1}),u(T,{class:"contact-list"},{default:i((()=>[o.teamInfo.contactInfo.wechat?(d(),l(T,{key:0,class:"contact-item"},{default:i((()=>[u(c,{class:"iconfont icon-weixin contact-icon wechat-color"}),u(c,{class:"contact-text"},{default:i((()=>[f("微信："+m(o.teamInfo.contactInfo.wechat),1)])),_:1}),u(c,{class:"copy-btn",onClick:t[1]||(t[1]=e=>n.copyText(o.teamInfo.contactInfo.wechat))},{default:i((()=>[f("复制")])),_:1})])),_:1})):I("",!0),o.teamInfo.contactInfo.phone?(d(),l(T,{key:1,class:"contact-item"},{default:i((()=>[u(c,{class:"iconfont icon-phone contact-icon phone-color"}),u(c,{class:"contact-text"},{default:i((()=>[f("电话："+m(o.showPhone?o.teamInfo.contactInfo.phone:n.hidePhone(o.teamInfo.contactInfo.phone)),1)])),_:1}),u(c,{class:"copy-btn",onClick:n.togglePhone},{default:i((()=>[f(m(o.showPhone?"隐藏":"查看"),1)])),_:1},8,["onClick"])])),_:1})):I("",!0),o.teamInfo.contactInfo.qq?(d(),l(T,{key:2,class:"contact-item"},{default:i((()=>[u(c,{class:"iconfont icon-qq contact-icon qq-color"}),u(c,{class:"contact-text"},{default:i((()=>[f("QQ群："+m(o.teamInfo.contactInfo.qq),1)])),_:1}),u(c,{class:"copy-btn",onClick:t[2]||(t[2]=e=>n.copyText(o.teamInfo.contactInfo.qq))},{default:i((()=>[f("复制")])),_:1})])),_:1})):I("",!0)])),_:1})])),_:1})):I("",!0)])),_:1})}],["__scopeId","data-v-66025a2c"]]);export{w as default};
