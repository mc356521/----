import{r as e,c as a,o as t,a8 as s,a9 as l,f as o,e as c,w as n,h as r,k as i,j as u,t as d,X as f,F as g,G as p,H as h,R as y,J as _,T as k,b as m,aa as v,Y as b,u as x,i as C,M as B,n as w}from"./index-DZtLzZ3A.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";const H=A({__name:"HeaderBar",props:{title:{type:String,default:"页面标题"},showSearch:{type:Boolean,default:!0},showFilter:{type:Boolean,default:!0},showAiRecommend:{type:Boolean,default:!1},categories:{type:Array,default:()=>[]},defaultCategory:{type:Number,default:0}},emits:["search","filter","category-change","ai-recommend","back"],setup(A,{expose:H,emit:j}){const F=["pages/index/index","pages/competition/index","pages/team/list","pages/profile/index"],I=A,M=e(I.defaultCategory),S=e(0),T=a((()=>{const e=y();if(0===e.length)return!0;const a=e[e.length-1].route||"";return F.includes(a)})),X=a((()=>{let e=90;return I.categories&&I.categories.length>0&&(e+=70),e})),D=j;function N(){D("search")}function R(){_({url:"/pages/Xiaoxi/Xiaoxi"})}function U(){D("back");y().length>1?k():m({url:"/pages/index/index"})}async function $(){try{const a=await v.getUnreadCount();if(200===a.code&&void 0!==a.data){S.value=a.data;const t=b();if(t&&t.globalData){t.globalData.unreadNotificationCount=a.data;try{t.updateMessageBadge&&t.updateMessageBadge()}catch(e){console.log("HeaderBar: 更新TabBar徽标失败",e)}}}}catch(e){console.error("获取未读消息数量失败:",e)}}H({headerHeight:X,unreadCount:S,fetchUnreadCount:$,isTabBarPage:T});let G=e(0),J=null;return t((()=>{s({success:e=>{e.safeArea&&e.safeArea.top&&(G.value=e.safeArea.top)}}),$(),J=setInterval((()=>{$()}),3e4)})),l((()=>{J&&(clearInterval(J),J=null)})),(e,a)=>{const t=x,s=C,l=B;return o(),c(s,{class:"sticky-header"},{default:n((()=>[r(s,{class:"header-title"},{default:n((()=>[T.value?i("",!0):(o(),c(s,{key:0,class:"back-btn",onClick:U},{default:n((()=>[r(t,{class:"iconfont icon-back"})])),_:1})),r(t,{class:"section-title"},{default:n((()=>[u(d(A.title),1)])),_:1}),r(s,{class:"header-actions"},{default:n((()=>[A.showSearch?(o(),c(s,{key:0,class:"action-btn",onClick:N},{default:n((()=>[r(t,{class:"iconfont icon-search"})])),_:1})):i("",!0),A.showFilter?(o(),c(s,{key:1,class:"action-btn message-btn",onClick:R},{default:n((()=>[r(t,{class:"iconfont icon-message"}),S.value>0?(o(),c(s,{key:0,class:"badge"},{default:n((()=>[u(d(S.value>99?"99+":S.value),1)])),_:1})):i("",!0)])),_:1})):i("",!0),f(e.$slots,"actions",{},void 0,!0)])),_:3})])),_:3}),A.categories&&A.categories.length>0?(o(),c(l,{key:0,"scroll-x":"true",class:"category-scroll"},{default:n((()=>[r(s,{class:"category-list"},{default:n((()=>[(o(!0),g(h,null,p(A.categories,((e,a)=>(o(),c(s,{key:a,class:w(["category-item",M.value===a?"active-category":""]),onClick:e=>function(e){M.value!==e&&(M.value=e,D("category-change",e))}(a)},{default:n((()=>[r(t,null,{default:n((()=>[u(d(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):i("",!0),f(e.$slots,"default",{},void 0,!0)])),_:3})}}},[["__scopeId","data-v-764be7fe"]]);export{H};
