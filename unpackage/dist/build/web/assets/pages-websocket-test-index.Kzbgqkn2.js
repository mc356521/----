import{ar as e,af as s,s as t,an as a,e as n,w as l,i as o,f as c,h as d,j as i,t as u,n as r,k as g,F as h,G as m,H as b,u as f,I as k,ad as p,x as C,y as _,N as v,M as y}from"./index-DZtLzZ3A.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=S({data:()=>({env:e,serverUrl:e.wsUrl||"ws://localhost:8080/ws",token:s()||"",debug:e.debug||!0,autoReconnect:!0,heartbeat:!0,isConnected:!1,messageTypes:["普通消息","聊天消息","认证消息"],messageTypeIndex:0,receiverId:"",messageContent:"",messages:[],scrollTop:0}),onLoad(){this.setupWebSocketCallbacks(),this.addMessage("系统",`环境: ${this.env.env||"未知"}`),this.addMessage("系统",`API地址: ${this.env.baseUrl||"未设置"}`),this.addMessage("系统",`WebSocket地址: ${this.env.wsUrl||"未设置"}`),this.addMessage("系统","Token: "+(this.token?"已设置":"未设置"))},onUnload(){this.disconnectWebSocket()},methods:{setupWebSocketCallbacks(){a.onOpen((e=>{this.isConnected=!0,this.addMessage("系统","WebSocket连接已打开")})),a.onClose((e=>{this.isConnected=!1,this.addMessage("系统",`WebSocket连接已关闭: ${e.code||""} ${e.reason||""}`)})),a.onError((e=>{this.addMessage("错误",`WebSocket连接错误: ${e.errMsg||JSON.stringify(e)}`)})),a.onMessage((e=>{let s=e;try{"string"==typeof e&&(s=JSON.parse(e),s=JSON.stringify(s,null,2))}catch(t){}this.addMessage("接收",s)}))},connectWebSocket(){this.isConnected?t({title:"WebSocket已连接",icon:"none"}):(a.initConfig({url:this.serverUrl,token:this.token,debug:this.debug,autoReconnect:this.autoReconnect,heartbeat:this.heartbeat}),a.connect(),this.addMessage("系统","正在连接WebSocket..."))},disconnectWebSocket(){this.isConnected?(a.close(),this.addMessage("系统","正在断开WebSocket连接...")):t({title:"WebSocket未连接",icon:"none"})},sendMessage(){if(!this.isConnected)return void t({title:"WebSocket未连接",icon:"none"});if(!this.messageContent)return void t({title:"消息内容不能为空",icon:"none"});let e;switch(this.messageTypeIndex){case 0:e=this.messageContent;break;case 1:e={type:"chat",to:this.receiverId,content:this.messageContent,timestamp:Date.now()};break;case 2:e={type:"auth",token:this.token||this.messageContent}}a.send(e)?(this.addMessage("发送","object"==typeof e?JSON.stringify(e,null,2):e),this.messageContent=""):t({title:"消息发送失败",icon:"none"})},addMessage(e,s){const t=new Date,a=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`;let n="";switch(e){case"系统":n="系统消息";break;case"发送":n="发送消息";break;case"接收":n="接收消息";break;case"错误":n="错误消息";break;default:n=e}this.messages.push({type:e,typeText:n,content:s,time:a}),this.messages.length>100&&this.messages.shift(),this.$nextTick((()=>{this.scrollTop=9999999}))},clearMessages(){this.messages=[]},onDebugChange(e){this.debug=e.detail.value},onAutoReconnectChange(e){this.autoReconnect=e.detail.value},onHeartbeatChange(e){this.heartbeat=e.detail.value},onMessageTypeChange(e){this.messageTypeIndex=e.detail.value}}},[["render",function(e,s,t,a,S,M){const x=f,T=o,W=k,I=p,U=C,w=_,V=v,$=y;return c(),n(T,{class:"container"},{default:l((()=>[d(T,{class:r(["status-bar",[S.isConnected?"connected":"disconnected"]])},{default:l((()=>[d(x,{class:"status-text"},{default:l((()=>[i("WebSocket状态: "+u(S.isConnected?"已连接":"未连接"),1)])),_:1}),d(T,{class:"status-indicator"})])),_:1},8,["class"]),d(T,{class:"env-info"},{default:l((()=>[d(x,{class:"env-title"},{default:l((()=>[i("当前环境: "+u(S.env.env),1)])),_:1}),d(x,{class:"env-detail"},{default:l((()=>[i("API地址: "+u(S.env.baseUrl),1)])),_:1}),d(x,{class:"env-detail"},{default:l((()=>[i("WebSocket地址: "+u(S.env.wsUrl),1)])),_:1})])),_:1}),d(T,{class:"connection-settings"},{default:l((()=>[d(T,{class:"form-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("服务器地址")])),_:1}),d(W,{class:"input",modelValue:S.serverUrl,"onUpdate:modelValue":s[0]||(s[0]=e=>S.serverUrl=e),placeholder:"ws://服务器地址/ws"},null,8,["modelValue"])])),_:1}),d(T,{class:"form-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("Token")])),_:1}),d(W,{class:"input",modelValue:S.token,"onUpdate:modelValue":s[1]||(s[1]=e=>S.token=e),placeholder:"可选，身份验证token"},null,8,["modelValue"])])),_:1}),d(T,{class:"form-item checkbox-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("调试模式")])),_:1}),d(I,{checked:S.debug,onChange:M.onDebugChange,color:"#4CAF50"},null,8,["checked","onChange"])])),_:1}),d(T,{class:"form-item checkbox-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("自动重连")])),_:1}),d(I,{checked:S.autoReconnect,onChange:M.onAutoReconnectChange,color:"#4CAF50"},null,8,["checked","onChange"])])),_:1}),d(T,{class:"form-item checkbox-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("心跳检测")])),_:1}),d(I,{checked:S.heartbeat,onChange:M.onHeartbeatChange,color:"#4CAF50"},null,8,["checked","onChange"])])),_:1}),d(T,{class:"button-group"},{default:l((()=>[d(U,{class:"btn connect-btn",onClick:M.connectWebSocket,disabled:S.isConnected},{default:l((()=>[i("连接")])),_:1},8,["onClick","disabled"]),d(U,{class:"btn disconnect-btn",onClick:M.disconnectWebSocket,disabled:!S.isConnected},{default:l((()=>[i("断开")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),d(T,{class:r(["message-sender",{disabled:!S.isConnected}])},{default:l((()=>[d(T,{class:"form-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("消息类型")])),_:1}),d(w,{onChange:M.onMessageTypeChange,value:S.messageTypeIndex,range:S.messageTypes},{default:l((()=>[d(T,{class:"picker"},{default:l((()=>[i(u(S.messageTypes[S.messageTypeIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),1===S.messageTypeIndex?(c(),n(T,{key:0,class:"form-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("接收者ID")])),_:1}),d(W,{class:"input",modelValue:S.receiverId,"onUpdate:modelValue":s[2]||(s[2]=e=>S.receiverId=e),placeholder:"接收者ID"},null,8,["modelValue"])])),_:1})):g("",!0),d(T,{class:"form-item"},{default:l((()=>[d(x,{class:"label"},{default:l((()=>[i("消息内容")])),_:1}),d(V,{class:"textarea",modelValue:S.messageContent,"onUpdate:modelValue":s[3]||(s[3]=e=>S.messageContent=e),placeholder:"请输入消息内容"},null,8,["modelValue"])])),_:1}),d(U,{class:"btn send-btn",onClick:M.sendMessage,disabled:!S.isConnected||!S.messageContent},{default:l((()=>[i("发送消息")])),_:1},8,["onClick","disabled"])])),_:1},8,["class"]),d(T,{class:"message-log"},{default:l((()=>[d(T,{class:"log-header"},{default:l((()=>[d(x,{class:"log-title"},{default:l((()=>[i("消息记录")])),_:1}),d(U,{class:"btn clear-btn",onClick:M.clearMessages},{default:l((()=>[i("清空")])),_:1},8,["onClick"])])),_:1}),d($,{class:"log-content","scroll-y":"","scroll-top":S.scrollTop},{default:l((()=>[0===S.messages.length?(c(),n(T,{key:0,class:"empty-log"},{default:l((()=>[d(x,null,{default:l((()=>[i("暂无消息记录")])),_:1})])),_:1})):g("",!0),(c(!0),h(b,null,m(S.messages,((e,s)=>(c(),n(T,{key:s,class:r(["message-item",e.type])},{default:l((()=>[d(T,{class:"message-header"},{default:l((()=>[d(x,{class:"message-type"},{default:l((()=>[i(u(e.typeText),1)])),_:2},1024),d(x,{class:"message-time"},{default:l((()=>[i(u(e.time),1)])),_:2},1024)])),_:2},1024),d(T,{class:"message-content"},{default:l((()=>[d(x,{class:"message-text"},{default:l((()=>[i(u(e.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1},8,["scroll-top"])])),_:1})])),_:1})}],["__scopeId","data-v-037e6161"]]);export{M as default};
