import{r as e,c as l,a,o,s,g as n,b as t,d as c,e as i,w as u,i as r,f as d,h as f,j as p,t as m,n as v,k as h,l as _,m as g,p as k,q as w,u as x,I as b,v as y,x as V,y as I}from"./index-DZtLzZ3A.js";import{a as C}from"./index.BRmG1gro.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./user.BA7q8pkn.js";import"./team.VNekZ19c.js";import"./competitions.CeqcXiK9.js";import"./taskApplications.MAaxBfY8.js";const N=j({__name:"login",setup(j){const N=e(!1),q=e(!0),U=e(!1),S=e([]),T=e([[],[]]),A=e([0,0]),D=e([]),O=e({}),H=l((()=>{if(0===T.value[0].length||0===T.value[1].length)return"";const e=A.value[0],l=A.value[1];if(!T.value[0][e]||!T.value[1][l])return"";return`${T.value[0][e].name} - ${T.value[1][l].name}`})),J=a({phone:"",password:""}),M=a({phoneNumber:"",password:"",realName:"",schoolId:1,role:"student",major:"",studentTeacherId:""});function $(e){const{column:l,value:a}=e.detail;if(0===l){A.value[0]=a,A.value[1]=0;const e=T.value[0][a].name;T.value[1]=O.value[e]||[]}else A.value[1]=a}function B(e){const[l,a]=e.detail.value;A.value=[l,a],T.value[1]&&T.value[1][a]&&(M.schoolId=T.value[1][a].id)}function E(){U.value=!U.value}function G(){N.value=!N.value}function F(){q.value=!q.value}async function W(){if(J.phone&&J.password){c("token"),_({title:"正在登录...",mask:!0});try{console.log("正在连接登录服务器...");const e=await C.user.login({phone:J.phone,password:J.password});g(),console.log("登录响应:",e),e&&e.token?(k("token",e.token),function(){if(N.value){const e={phone:J.phone,password:J.password};k("loginInfo",JSON.stringify(e))}else c("loginInfo")}(),s({title:"登录成功",icon:"success"}),setTimeout((()=>{t({url:"/pages/index/index"})}),1500)):s({title:"登录失败，请检查账号密码",icon:"none"})}catch(e){console.error("登录失败:",e),g(),s({title:e.message||"登录失败，请检查网络连接或服务器配置",icon:"none",duration:3e3})}}else s({title:"请输入手机号和密码",icon:"none"})}async function Y(){if(M.phoneNumber)if(M.password)if(M.realName)if(M.schoolId)if(M.major)if(M.studentTeacherId)try{c("token"),console.log("发送的注册数据:",JSON.stringify(M));await C.user.register(M);s({title:"注册成功",icon:"success"}),U.value=!1}catch(e){s({title:e.message||"注册失败",icon:"none",duration:3e3}),console.error("注册失败:",e)}else s({title:"请输入学号",icon:"none"});else s({title:"请输入专业",icon:"none"});else s({title:"请选择学校",icon:"none"});else s({title:"请输入姓名",icon:"none"});else s({title:"请输入密码",icon:"none"});else s({title:"请输入手机号",icon:"none"})}function z(){s({title:"忘记密码功能开发中",icon:"none"})}function K(e){s({title:`${e}登录功能开发中`,icon:"none"})}function L(){s({title:"服务条款",icon:"none"})}function P(){s({title:"隐私政策",icon:"none"})}return o((async()=>{try{const e=await C.user.getSchools();if(e&&e.data){S.value=e.data;const l={},a={};if(e.data.forEach((e=>{l[e.province]||(l[e.province]={id:e.province,name:e.province},a[e.province]=[]),a[e.province].push(e)})),D.value=Object.values(l),O.value=a,T.value[0]=D.value,D.value.length>0){const e=D.value[0].name;T.value[1]=O.value[e]||[]}if(M.schoolId){const e=S.value.find((e=>e.id===M.schoolId));if(e){const l=D.value.findIndex((l=>l.name===e.province));if(-1!==l){A.value[0]=l;const a=O.value[e.province]||[],o=a.findIndex((l=>l.id===e.id));-1!==o&&(T.value[1]=a,A.value[1]=o)}}}}}catch(a){console.error("获取学校列表失败:",a),s({title:"获取学校列表失败",icon:"none"})}const e=n("token"),l=n("loginInfo");if(e)try{return console.log("检测到已有token，尝试自动登录"),void t({url:"/pages/index/index"})}catch(a){console.error("自动登录失败，token可能已过期:",a),c("token")}if(l)try{const e=JSON.parse(l);J.phone=e.phone||"",J.password=e.password||"",N.value=!0}catch(a){console.error("解析保存的登录信息失败:",a)}})),(e,l)=>{const a=w,o=r,s=x,n=b,t=y,c=V,_=I;return d(),i(o,{class:"container"},{default:u((()=>[f(o,{class:"content-area"},{default:u((()=>[f(o,{class:"top-image"},{default:u((()=>[f(a,{src:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",mode:"aspectFill",class:"campus-image"})])),_:1}),f(o,{class:"welcome-text"},{default:u((()=>[f(s,{class:"welcome-title"},{default:u((()=>[p(m(U.value?"注册账号":"欢迎回来"),1)])),_:1}),f(s,{class:"welcome-subtitle"},{default:u((()=>[p(m(U.value?"创建您的校园平台账号":"登录您的校园平台账号，开启校园新体验"),1)])),_:1})])),_:1}),U.value?(d(),i(o,{key:1,class:"login-form"},{default:u((()=>[f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-mobile"}),f(n,{type:"text",placeholder:"手机号",class:"form-input",modelValue:M.phoneNumber,"onUpdate:modelValue":l[2]||(l[2]=e=>M.phoneNumber=e)},null,8,["modelValue"])])),_:1})])),_:1}),f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-lock"}),f(n,{type:"text",placeholder:"密码",class:"form-input",modelValue:M.password,"onUpdate:modelValue":l[3]||(l[3]=e=>M.password=e),password:q.value},null,8,["modelValue","password"]),f(s,{class:v(["iconfont",q.value?"icon-eye-slash":"icon-eye"]),onClick:F},null,8,["class"])])),_:1})])),_:1}),f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-user"}),f(n,{type:"text",placeholder:"真实姓名",class:"form-input",modelValue:M.realName,"onUpdate:modelValue":l[4]||(l[4]=e=>M.realName=e)},null,8,["modelValue"])])),_:1})])),_:1}),f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-graduation"}),f(_,{mode:"multiSelector",onChange:B,onColumnchange:$,value:A.value,range:T.value,"range-key":"name",class:"school-picker"},{default:u((()=>[f(o,{class:"picker-content"},{default:u((()=>[f(s,{class:"picker-text"},{default:u((()=>[p(m(H.value||"请选择学校（省份-学校）"),1)])),_:1}),f(s,{class:"iconfont icon-arrow-left picker-arrow"})])),_:1})])),_:1},8,["value","range"])])),_:1})])),_:1}),f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-graduation"}),f(n,{type:"text",placeholder:"专业",class:"form-input",modelValue:M.major,"onUpdate:modelValue":l[5]||(l[5]=e=>M.major=e)},null,8,["modelValue"])])),_:1})])),_:1}),f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-graduation"}),f(n,{type:"text",placeholder:"学号",class:"form-input",modelValue:M.studentTeacherId,"onUpdate:modelValue":l[6]||(l[6]=e=>M.studentTeacherId=e)},null,8,["modelValue"])])),_:1})])),_:1}),f(c,{class:"login-btn",onClick:Y,"hover-class":"btn-hover"},{default:u((()=>[p("注册")])),_:1}),f(c,{class:"register-btn",onClick:E,"hover-class":"register-btn-hover"},{default:u((()=>[p("返回登录")])),_:1})])),_:1})):(d(),i(o,{key:0,class:"login-form"},{default:u((()=>[f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-user"}),f(n,{type:"text",placeholder:"学号/手机号",class:"form-input",modelValue:J.phone,"onUpdate:modelValue":l[0]||(l[0]=e=>J.phone=e)},null,8,["modelValue"])])),_:1})])),_:1}),f(o,{class:"input-field"},{default:u((()=>[f(o,{class:"input-content"},{default:u((()=>[f(s,{class:"iconfont icon-user"}),f(n,{type:"text",placeholder:"密码",class:"form-input",modelValue:J.password,"onUpdate:modelValue":l[1]||(l[1]=e=>J.password=e),password:q.value},null,8,["modelValue","password"]),f(s,{class:v(["iconfont",q.value?"icon-eye-slash":"icon-eye"]),onClick:F},null,8,["class"])])),_:1})])),_:1}),f(o,{class:"remember-row"},{default:u((()=>[f(o,{class:"remember-me"},{default:u((()=>[f(t,{value:"1",checked:N.value,onClick:G,class:"remember-checkbox",color:"#4A90E2"},null,8,["checked"]),f(s,{class:"remember-text"},{default:u((()=>[p("记住我")])),_:1})])),_:1}),f(s,{class:"forgot-password",onClick:z},{default:u((()=>[p("忘记密码?")])),_:1})])),_:1}),f(c,{class:"login-btn",onClick:W,"hover-class":"btn-hover"},{default:u((()=>[p("登录")])),_:1}),f(c,{class:"register-btn",onClick:E,"hover-class":"register-btn-hover"},{default:u((()=>[p("注册新账号")])),_:1})])),_:1})),U.value?h("",!0):(d(),i(o,{key:2,class:"other-login"},{default:u((()=>[f(o,{class:"divider"},{default:u((()=>[f(o,{class:"divider-line"}),f(s,{class:"divider-text"},{default:u((()=>[p("其他登录方式")])),_:1}),f(o,{class:"divider-line"})])),_:1}),f(o,{class:"social-buttons"},{default:u((()=>[f(o,{class:"social-btn",onClick:l[7]||(l[7]=e=>K("wechat")),"hover-class":"social-btn-hover"},{default:u((()=>[f(s,{class:"iconfont icon-weixin"})])),_:1}),f(o,{class:"social-btn",onClick:l[8]||(l[8]=e=>K("qq")),"hover-class":"social-btn-hover"},{default:u((()=>[f(s,{class:"iconfont icon-qq"})])),_:1}),f(o,{class:"social-btn",onClick:l[9]||(l[9]=e=>K("phone")),"hover-class":"social-btn-hover"},{default:u((()=>[f(s,{class:"iconfont icon-mobile"})])),_:1})])),_:1})])),_:1})),f(o,{class:"footer-text"},{default:u((()=>[f(s,{class:"agreement-text"},{default:u((()=>[p(m(U.value?"注册即表示您同意我们的":"登录即表示您同意我们的"),1)])),_:1}),f(s,{class:"link-text",onClick:L},{default:u((()=>[p("服务条款")])),_:1}),f(s,{class:"agreement-text"},{default:u((()=>[p("和")])),_:1}),f(s,{class:"link-text",onClick:P},{default:u((()=>[p("隐私政策")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-1c5726f5"]]);export{N as default};
