import{r as a,c as e,o as t,O as s,s as l,P as r,E as n,e as c,w as u,i as o,f as i,h as d,j as f,F as v,G as g,H as _,t as p,n as k,k as m,Q as y,J as h,R as w,T as b,b as x,u as C,M as T,q as N}from"./index-DZtLzZ3A.js";import{_ as j}from"./uni-load-more.BvkDUI9A.js";import{r as A}from"./uni-app.es.CpsDs8gT.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const q=M({__name:"index",setup(M){const q=a([{id:0,name:"全部"}]),$=[{label:"全部",value:""},{label:"招募中",value:"recruiting"},{label:"进行中",value:"ongoing"},{label:"已完成",value:"completed"},{label:"已取消",value:"canceled"}],D=a(0),E=a(""),F=a([]),G=a(1),P=a(10),I=a(!1),R=a(!1),S=a(!1),z=a({contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"已经到底啦"}),H=a(!1),J=e((()=>{if(H.value){const a=ta().length;return 300+80*Math.ceil(a/4)+30+"rpx"}return"300rpx"}));async function O(){R.value||(I.value=!0);try{const a={pageNum:G.value,pageSize:P.value};0!==D.value&&(a.categoryId=D.value),E.value&&(a.status=E.value);const e=await s({url:"/tasks/list",method:"GET",params:a});200===e.code&&e.data?(1===G.value?(F.value=e.data.records||[],R.value&&l({title:"刷新成功",icon:"success",duration:1500})):(F.value=[...F.value,...e.data.records||[]],e.data.records&&e.data.records.length>0&&l({title:`加载了${e.data.records.length}条新数据`,icon:"none",duration:1500})),e.data.current>=e.data.pages||!e.data.records||0===e.data.records.length?S.value=!0:S.value=!1):(console.error("获取任务列表失败:",e),l({title:"获取任务列表失败",icon:"none"}))}catch(a){console.error("获取任务列表异常:",a),l({title:"网络异常，请稍后重试",icon:"none"})}finally{I.value=!1,R.value&&(R.value=!1,r())}}function Q(){I.value||(R.value=!0,G.value=1,S.value=!1,O())}function U(a){if(!a)return"";try{const e=new Date(a);return`${e.getMonth()+1}月${e.getDate()}日`}catch(e){return a}}function B(a){D.value!==a&&(D.value=a,G.value=1,S.value=!1,F.value=[],O())}function K(){I.value||R.value||S.value||(l({title:"加载更多数据...",icon:"none",duration:800}),G.value++,O())}function L(a){switch(a){case"问卷调查":case"技术支持":default:return"tag-blue";case"数据收集":case"志愿服务":return"tag-green";case"实验参与":return"tag-purple";case"校园活动":return"tag-orange";case"学术研究":return"tag-pink";case"竞赛协助":return"tag-yellow"}}function V(a){switch(a){case"recruiting":default:return"status-recruiting";case"ongoing":return"status-ongoing";case"completed":return"status-ended";case"canceled":return"status-canceled"}}function W(a){switch(a){case"现金":return"reward-orange";case"学分":return"reward-blue";case"志愿服务":return"reward-green";case"证书":return"reward-yellow";case"礼品":return"reward-purple";default:return"reward-gray"}}function X(){h({url:"/pages/task-square/create"})}function Y(){h({url:"/pages/task-square/search"})}function Z(){h({url:"/pages/notification/index"})}function aa(){w().length>1?b():x({url:"/pages/index/index"})}function ea(){H.value=!H.value}function ta(){return q.value.slice(4)}return t((()=>{z.value={contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"已经到底啦"},async function(){try{const a=await s({url:"/taskCategories",method:"GET"});if(200===a.code&&a.data&&Array.isArray(a.data)){const e=[{id:0,name:"全部"},...a.data];q.value=e}else console.error("获取任务分类失败:",a)}catch(a){console.error("获取任务分类异常:",a),l({title:"获取分类失败",icon:"none"})}}(),O()})),(a,e)=>{const t=C,s=o,l=T,r=N,w=A(n("uni-load-more"),j);return i(),c(s,{class:"container"},{default:u((()=>[d(s,{class:"header-fixed",style:y({height:J.value})},{default:u((()=>[d(s,{class:"header-bar"},{default:u((()=>[d(s,{class:"back-btn",onClick:aa},{default:u((()=>[d(t,{class:"iconfont icon-back"})])),_:1}),d(s,{class:"header-title"},{default:u((()=>[f("任务广场")])),_:1}),d(s,{class:"header-actions"},{default:u((()=>[d(s,{class:"action-btn",onClick:Y},{default:u((()=>[d(t,{class:"iconfont icon-search"})])),_:1}),d(s,{class:"action-btn",onClick:Z},{default:u((()=>[d(t,{class:"iconfont icon-notification"})])),_:1})])),_:1})])),_:1}),d(s,{class:"filter-container"},{default:u((()=>[d(s,{class:"category-section"},{default:u((()=>[d(s,{class:"main-categories"},{default:u((()=>[(i(!0),v(_,null,g(q.value.slice(0,4),(a=>(i(),c(s,{key:a.id,class:k(["category-tag",D.value===a.id?"category-tag-active":""]),onClick:e=>B(a.id)},{default:u((()=>[f(p(a.name),1)])),_:2},1032,["class","onClick"])))),128)),q.value.length>4?(i(),c(s,{key:0,class:"more-btn",onClick:ea},{default:u((()=>[f(p(H.value?"收起":"更多")+" ",1),d(t,{class:k(["iconfont",H.value?"icon-arrow-up":"icon-arrow-down"])},null,8,["class"])])),_:1})):m("",!0)])),_:1}),H.value?(i(),c(s,{key:0,class:"more-categories-container"},{default:u((()=>[d(s,{class:"more-categories"},{default:u((()=>[(i(!0),v(_,null,g(ta(),(a=>(i(),c(s,{key:a.id,class:k(["category-tag",D.value===a.id?"category-tag-active":""]),onClick:e=>B(a.id)},{default:u((()=>[f(p(a.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):m("",!0)])),_:1}),d(s,{class:"divider"}),d(l,{"scroll-x":"",class:"status-scroll","show-scrollbar":"false"},{default:u((()=>[d(s,{class:"status-container"},{default:u((()=>[(i(),v(_,null,g($,((a,e)=>d(s,{key:e,class:k(["status-filter-tag",E.value===a.value?"status-filter-active":""]),onClick:e=>{return t=a.value,void(E.value!==t&&(E.value=t,G.value=1,S.value=!1,F.value=[],O()));var t}},{default:u((()=>[f(p(a.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),d(l,{"scroll-y":"",class:"tasks-scroll",style:y({"padding-top":J.value}),onScrolltolower:K,onRefresherrefresh:Q,"refresher-enabled":"true","refresher-triggered":R.value,"refresher-background":"#f5f5f5"},{default:u((()=>[d(s,{class:"tasks-container"},{default:u((()=>[R.value?(i(),c(s,{key:0,class:"refresh-tip"},{default:u((()=>[d(t,{class:"refresh-text"},{default:u((()=>[f("正在刷新数据...")])),_:1})])),_:1})):m("",!0),(i(!0),v(_,null,g(F.value,(a=>(i(),c(s,{class:"task-card",key:a.id,onClick:e=>{return t=a.id,void h({url:`/pages/task-square/detail?id=${t}`});var t}},{default:u((()=>[d(s,{class:"task-header"},{default:u((()=>[d(s,null,{default:u((()=>[d(s,{class:"task-title"},{default:u((()=>[f(p(a.title),1)])),_:2},1024),d(s,{class:"task-tags"},{default:u((()=>[d(t,{class:k(["task-tag",L(a.categoryName)])},{default:u((()=>[f(p(a.categoryName),1)])),_:2},1032,["class"]),d(t,{class:k(["task-status-tag",V(a.status)])},{default:u((()=>[f(p(a.statusText),1)])),_:2},1032,["class"]),d(t,{class:"task-deadline"},{default:u((()=>[f("截止: "+p(U(a.deadline)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(s,{class:k(["task-reward",W(a.rewardTypeName)])},{default:u((()=>["现金"===a.rewardTypeName?(i(),c(t,{key:0},{default:u((()=>[f("¥"+p(a.rewardAmount),1)])),_:2},1024)):"学分"===a.rewardTypeName?(i(),c(t,{key:1},{default:u((()=>[f(p(a.rewardAmount)+"学分",1)])),_:2},1024)):(i(),c(t,{key:2},{default:u((()=>[f(p(a.rewardTypeName),1)])),_:2},1024))])),_:2},1032,["class"])])),_:2},1024),d(s,{class:"task-desc"},{default:u((()=>[f(p(a.shortDescription),1)])),_:2},1024),a.location?(i(),c(s,{key:0,class:"task-location"},{default:u((()=>[d(t,{class:"iconfont icon-location"}),d(t,{class:"location-text"},{default:u((()=>[f(p(a.location),1)])),_:2},1024)])),_:2},1024)):m("",!0),d(s,{class:"task-footer"},{default:u((()=>[d(s,{class:"task-publisher"},{default:u((()=>[d(r,{class:"publisher-avatar",src:a.creatorAvatarUrl||"https://via.placeholder.com/100",mode:"aspectFill"},null,8,["src"]),d(t,{class:"publisher-info"},{default:u((()=>[f(p(a.creatorName)+" · "+p(a.creatorMajor),1)])),_:2},1024)])),_:2},1024),d(s,{class:"task-stats"},{default:u((()=>[d(t,{class:"stat-item"},{default:u((()=>[d(t,{class:"iconfont icon-view"}),f(" "+p(a.viewCount),1)])),_:2},1024),d(t,{class:"stat-item"},{default:u((()=>[d(t,{class:"iconfont icon-user"}),f(" "+p(a.currentParticipants)+"/"+p(a.maxParticipants),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0!==F.value.length||I.value?m("",!0):(i(),c(s,{key:1,class:"empty-state"},{default:u((()=>[d(r,{class:"empty-image",src:"/static/empty-task.png",mode:"aspectFit"}),d(t,{class:"empty-text"},{default:u((()=>[f("暂无任务数据")])),_:1})])),_:1})),I.value&&!R.value?(i(),c(s,{key:2,class:"loading-more"},{default:u((()=>[d(w,{status:"loading",contentText:z.value},null,8,["contentText"])])),_:1})):m("",!0),S.value&&!I.value&&F.value.length>0?(i(),c(s,{key:3,class:"no-more"},{default:u((()=>[d(w,{status:"noMore",contentText:z.value},null,8,["contentText"])])),_:1})):m("",!0),d(s,{class:"safe-area-bottom"})])),_:1})])),_:1},8,["style","refresher-triggered"]),d(s,{class:"float-btn",onClick:X},{default:u((()=>[d(t,{class:"iconfont icon-plus"})])),_:1})])),_:1})}}},[["__scopeId","data-v-b5c4ac2a"]]);export{q as default};
