import{r as a,o as e,g as t,c as s,f as o,e as c,w as i,h as n,j as l,k as r,n as u,b as p,V as f,J as m,a1 as d,u as b,i as v}from"./index-DZtLzZ3A.js";import{u as g}from"./user.BA7q8pkn.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=h({__name:"TabBar",props:{activeTab:{type:String,default:"home",validator:a=>["home","competition","task-square","team","profile"].includes(a)}},emits:["tab-change","publish"],setup(h,{emit:k}){const x=h,_=a("");e((()=>{t("token")&&async function(){try{const a=await g.getUserRole();200===a.code&&a.data&&(_.value=a.data,console.log("当前用户角色:",_.value))}catch(a){console.error("获取用户角色失败:",a)}}()}));const T=s((()=>!1)),y=k;function C(a){if(a!==x.activeTab){p({url:{home:"/pages/index/index",competition:"/pages/competition/index","task-square":"/pages/task-square/index",team:"/pages/team/list",profile:"/pages/profile/index"}[a],fail:e=>{console.error("切换Tab失败:",e),y("tab-change",a)}})}}function j(){const a=t("token");a?(console.log("当前token:",a),_.value?(console.log("使用缓存角色信息:",_.value),q()):(console.log("开始获取用户角色..."),g.getUserRole(a).then((a=>{console.log("获取角色成功, 完整响应:",a),200===a.code&&a.data?(_.value=a.data,console.log("设置当前用户角色:",_.value),q()):(console.warn("获取角色返回异常:",a),q())})).catch((a=>{console.error("获取用户角色失败:",a),console.error("错误详情:",JSON.stringify(a)),q()})))):f({title:"提示",content:"请先登录后再操作",confirmText:"去登录",success:function(a){a.confirm&&m({url:"/pages/login/login"})}})}function q(){const a=[];"admin"===_.value&&a.push({text:"创建竞赛",action:()=>{m({url:"/pages/competition/create"})}}),a.push({text:"创建队伍",action:()=>{m({url:"/pages/team/create"})}},{text:"发布任务",action:()=>{m({url:"/pages/task-square/create"})}});const e=a.map((a=>a.text));d({itemList:e,success:function(e){const t=e.tapIndex;t>=0&&t<a.length&&a[t].action()}})}return(a,e)=>{const t=b,s=v;return o(),c(s,{class:u(["tab-bar",{"dark-mode":T.value}])},{default:i((()=>[n(s,{class:u(["tab-item",{active:"home"===h.activeTab}]),onClick:e[0]||(e[0]=a=>C("home"))},{default:i((()=>[n(t,{class:"iconfont icon-home"}),n(t,{class:"tab-text"},{default:i((()=>[l("首页")])),_:1}),"home"===h.activeTab?(o(),c(s,{key:0,class:"active-indicator"})):r("",!0)])),_:1},8,["class"]),n(s,{class:u(["tab-item",{active:"competition"===h.activeTab}]),onClick:e[1]||(e[1]=a=>C("competition"))},{default:i((()=>[n(t,{class:"iconfont icon-trophy"}),n(t,{class:"tab-text"},{default:i((()=>[l("竞赛")])),_:1}),"competition"===h.activeTab?(o(),c(s,{key:0,class:"active-indicator"})):r("",!0)])),_:1},8,["class"]),n(s,{class:"publish-btn-container"},{default:i((()=>[n(s,{class:"publish-btn pulse",onClick:j},{default:i((()=>[n(t,{class:"iconfont icon-plus"})])),_:1})])),_:1}),n(s,{class:u(["tab-item",{active:"team"===h.activeTab}]),onClick:e[2]||(e[2]=a=>C("team"))},{default:i((()=>[n(t,{class:"iconfont icon-users"}),n(t,{class:"tab-text"},{default:i((()=>[l("队伍")])),_:1}),"team"===h.activeTab?(o(),c(s,{key:0,class:"active-indicator"})):r("",!0)])),_:1},8,["class"]),n(s,{class:u(["tab-item",{active:"profile"===h.activeTab}]),onClick:e[3]||(e[3]=a=>C("profile"))},{default:i((()=>[n(t,{class:"iconfont icon-user"}),n(t,{class:"tab-text"},{default:i((()=>[l("我的")])),_:1}),"profile"===h.activeTab?(o(),c(s,{key:0,class:"active-indicator"})):r("",!0)])),_:1},8,["class"])])),_:1},8,["class"])}}},[["__scopeId","data-v-76cffd4d"]]);export{k as T};
